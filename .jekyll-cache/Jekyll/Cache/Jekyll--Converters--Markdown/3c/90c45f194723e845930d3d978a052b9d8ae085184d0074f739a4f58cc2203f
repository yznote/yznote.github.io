I"†<h4 id="iosé›†æˆbraintreepaypalæ”¯ä»˜">iOSé›†æˆBraintree+Paypalæ”¯ä»˜</h4>

<p><strong>å®˜æ–¹æ–‡æ¡£</strong></p>

<p><a href="https://developers.braintreepayments.com/guides/paypal/client-side/ios/v4">iOS SDK Url0</a><br />
<a href="https://developers.braintreepayments.com/guides/paypal/client-side/ios/v4#setup-for-app-switch">iOS SDK Url1</a></p>

<p><strong>ç¬¬ä¸€æ­¥:åˆ›å»ºæ²™ç›’/ç”Ÿäº§è´¦å·</strong></p>

<blockquote>
  <p><a href="https://www.braintreepayments.com/sandbox">æ²™ç›’æ³¨å†Œé“¾æ¥</a><br />
<a href="https://sandbox.braintreegateway.com/">æ²™ç›’ç™»é™†é“¾æ¥</a><br />
<a href="https://www.braintreegateway.com/login">ç”Ÿäº§ç™»é™†é“¾æ¥</a></p>
</blockquote>

<p>æ³¨å†Œã€ç™»é™†ä¹‹åç‚¹å‡»<code class="highlighter-rouge">è®¾ç½®-API-Generate New Tokenization Key</code>ç”Ÿæˆæ²™ç›’/ç”Ÿäº§ç¯å¢ƒçš„<code class="highlighter-rouge">Token</code>å¦‚å›¾æ‰€ç¤º:</p>

<p><img src="/img/20201222/1.png" alt="å›¾1" /></p>

<p><strong>ç¬¬äºŒæ­¥:ä¸‹è½½SDK</strong></p>

<p><em>Pod</em></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pod 'BraintreeDropIn'
</code></pre></div></div>

<p><em>æ‰‹åŠ¨å¯¼å…¥</em></p>
<blockquote>
  <p>é“¾æ¥:<a href="https://github.com/braintree/braintree_ios">https://github.com/braintree/braintree_ios</a><br />
å¯¼å…¥æ–‡ä»¶:<code class="highlighter-rouge">BraintreeCoreã€BraintreePaypal</code></p>
</blockquote>

<p><strong>ç¬¬ä¸‰æ­¥:URL Schemes</strong></p>
<blockquote>
  <p>æ ¼å¼:bunldID+.payments<br />
åœ¨ targets - info - Url Typesä¸­æ·»åŠ  bunldID+.payments</p>
</blockquote>

<p><strong>ç¬¬å››æ­¥:ä»£ç </strong></p>

<p><code class="highlighter-rouge">AppDelegate</code></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#import "BTAppSwitch.h"

- (BOOL)application:(UIApplication*)application didFinishLaunchingWithOptions:(NSDictionary*)launchOptions
{
    [BTAppSwitch setReturnURLScheme:@"com.rk.xxxx.payments"];
    
    return YES;
} 

- (BOOL)application:(UIApplication *)app openURL:(NSURL *)url options:(NSDictionary&lt;NSString*, id&gt; *)options
{
    if ([url.scheme localizedCaseInsensitiveCompare:@"com.rk.xxxx.payments"] == NSOrderedSame) {
        return [BTAppSwitch handleOpenURL:url options:options];
    }
    
    return NO;
}
</code></pre></div></div>
<p><code class="highlighter-rouge">æ”¯ä»˜é¡µé¢</code></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#import "ViewController.h"
#import "BraintreePayPal.h"
#import "SVProgressHUD.h"

@interface ViewController ()&lt;BTViewControllerPresentingDelegate&gt;

@property (strong, nonatomic) BTPayPalDriver *payPalDriver;

@end

@implementation ViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    // Do any additional setup after loading the view, typically from a nib.
    
    UIButton *button = [[UIButton alloc] initWithFrame:CGRectMake(100, 100, 100, 40)];
    [button setTitle:@"paypal" forState:UIControlStateNormal];
    [button setTitleColor:[UIColor blueColor] forState:UIControlStateNormal];
    [button addTarget:self action:@selector(buttonOnClick) forControlEvents:UIControlEventTouchUpInside];
    [self.view addSubview:button];
}

- (BTPayPalDriver *)payPalDriver
{
    if (!_payPalDriver) {
        //TODO æ›¿æ¢ä¸ºè‡ªå·±çš„ token
        BTAPIClient *braintreeClient = [[BTAPIClient alloc] initWithAuthorization:@"production_bn7dy6sh_m7rf4gn9dmswttsh"];
//        BTAPIClient *braintreeClient = [[BTAPIClient alloc] initWithAuthorization:@"sandbox_38cjh9r7_tpmv9kr9kpxvnrkn"];
        _payPalDriver = [[BTPayPalDriver alloc] initWithAPIClient:braintreeClient];
        _payPalDriver.viewControllerPresentingDelegate = self;
    }
    return _payPalDriver;
}

- (void)buttonOnClick
{
    [SVProgressHUD setDefaultStyle:SVProgressHUDStyleLight];
    [SVProgressHUD setForegroundColor:[UIColor whiteColor]];
    [SVProgressHUD setBackgroundColor:[UIColor lightGrayColor]];
    [SVProgressHUD show];
    
    NSString *price = @"199";
    NSString *orderNo = @"100320_201222135431766";
    BTPayPalRequest *request = [[BTPayPalRequest alloc] initWithAmount:price];
    request.currencyCode = @"USD";
    
    BTPayPalLineItem *item = [[BTPayPalLineItem alloc] initWithQuantity:@"1" unitAmount:price name:@"å•†å“åç§°" kind:BTPayPalLineItemKindDebit];
    item.productCode = orderNo; //è®¢å•ç¼–å·
    request.lineItems = @[item];

    [self.payPalDriver requestOneTimePayment:request completion:^(BTPayPalAccountNonce * _Nullable tokenizedPayPalAccount, NSError * _Nullable error) {
          
        if (tokenizedPayPalAccount) {
            NSLog(@"--&gt;&gt; paypal æ”¯ä»˜æˆåŠŸ nonce:%@", tokenizedPayPalAccount.nonce);
            [SVProgressHUD showSuccessWithStatus:@"æ”¯ä»˜æˆåŠŸ"];
            
            //todo è°ƒç”¨åå°æ¥å£ï¼Œä¼ é€’ tokenizedPayPalAccount.nonce
            
        } else if (error) {
            // Handle error here...
            NSLog(@"paypal æ”¯ä»˜å¤±è´¥ ï¼š%@", error);
            [SVProgressHUD showErrorWithStatus:@"æ”¯ä»˜å¤±è´¥"];
            
        } else {
            // Buyer canceled payment approval
            [SVProgressHUD showErrorWithStatus:@"æ”¯ä»˜å–æ¶ˆ"];
        }
        
        [SVProgressHUD dismissWithDelay:3];
    }];
}

#pragma mark - BTViewControllerPresentingDelegate
// Required
- (void)paymentDriver:(id)paymentDriver requestsPresentationOfViewController:(UIViewController *)viewController
{
    [SVProgressHUD dismiss];
    viewController.modalPresentationStyle = 0;
    [self presentViewController:viewController animated:YES completion:nil];
}

// Required
- (void)paymentDriver:(id)paymentDriver requestsDismissalOfViewController:(UIViewController *)viewController
{
    [viewController dismissViewControllerAnimated:YES completion:^{
        [SVProgressHUD show];
    }];
}


@end
</code></pre></div></div>

<h4 id="å®¢æˆ·ä¿¡æ¯">å®¢æˆ·ä¿¡æ¯</h4>

<blockquote>
  <p>ç”Ÿäº§:<br />
https://www.braintreegateway.com/login<br />
ç™»å½•ç”¨æˆ·å<br />
wesay<br />
kaifa123<br />
æ²™ç›’:<br />
https://sandbox.braintreegateway.com/<br />
ID wesaygaming<br />
PW Kaifa123</p>
</blockquote>

<p><a href="https://www.jianshu.com/p/1a59e0a0ed28">å‚è€ƒ1</a><br />
<a href="https://github.com/hw20101101/TestBraintree">å‚è€ƒ2</a></p>

:ET