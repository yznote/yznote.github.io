I"'<h5 id="uicontrolæ‰©å±•">UIControlæ‰©å±•</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@interface UIControl (RKRepeatClick)

/**
 å¯ä»¥é‡å¤ç‚¹å‡»çš„æ—¶é—´é—´éš”
 é»˜è®¤ä¸º0 ä¸å¯¹æŒ‰é’®é‡å¤ç‚¹å‡»å¤„ç†
 */
@property (nonatomic,assign) NSTimeInterval timeInterval;   //ç”¨è¿™ä¸ªç»™é‡å¤ç‚¹å‡»åŠ é—´éš”
/**
 å†…éƒ¨å±æ€§ç”¨äºåˆ¤æ–­æ˜¯å¦å¿½ç•¥æ›¿æ¢çš„ç‚¹å‡»äº‹ä»¶
 */
@property (nonatomic,assign) BOOL isIgnoreEvent;

/**
 * å¦‚æœæƒ³è¦buttonå“åº”è¿ç»­ç‚¹å‡»,æ­¤å±æ€§è¦è®¾ç½®ä¸ºYESã€ä¾‹å¦‚:åŒæ—¶å“åº”æŒ‰é’®çš„æŒ‰ä¸‹å’ŒæŠ¬èµ·ã€‘
 */
@property(nonatomic,assign)BOOL canResponseRepeatClick;

@end
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#import "UIControl+RKRepeatClick.h"

#import &lt;objc/runtime.h&gt;
#define defaultInterval 0.5 //é»˜è®¤æ—¶é—´é—´éš”  0.5

@implementation UIControl (RKRepeatClick)

- (NSTimeInterval)timeInterval{
    return [objc_getAssociatedObject(self,_cmd)doubleValue];
}

- (void)setTimeInterval:(NSTimeInterval)timeInterval{
    objc_setAssociatedObject(self,@selector(timeInterval),@(timeInterval),OBJC_ASSOCIATION_RETAIN_NONATOMIC);
}

- (void)setIsIgnoreEvent:(BOOL)isIgnoreEvent{
    objc_setAssociatedObject(self,@selector(isIgnoreEvent),@(isIgnoreEvent),OBJC_ASSOCIATION_RETAIN_NONATOMIC);
}

- (BOOL)isIgnoreEvent{
    return [objc_getAssociatedObject(self,_cmd)boolValue];
}

- (void)resetState{
    [self setIsIgnoreEvent:NO];
}

- (void)setCanResponseRepeatClick:(BOOL)canResponseRepeatClick {
    objc_setAssociatedObject(self,@selector(canResponseRepeatClick),@(canResponseRepeatClick),OBJC_ASSOCIATION_RETAIN_NONATOMIC);
}

- (BOOL)canResponseRepeatClick {
    return [objc_getAssociatedObject(self,_cmd)boolValue];
}

+ (void)load{
    static dispatch_once_t onceToken;
    dispatch_once(&amp;onceToken, ^{
        SEL selA = @selector(sendAction:to:forEvent:);
        SEL selB = @selector(mySendAction:to:forEvent:);
        Method methodA = class_getInstanceMethod(self, selA);
        Method methodB = class_getInstanceMethod(self, selB);
        //å°†methodBçš„å®ç°æ·»åŠ åˆ°ç³»ç»Ÿæ–¹æ³•ä¸­ä¹Ÿå°±æ˜¯è¯´å°†methodAæ–¹æ³•æŒ‡é’ˆæ·»åŠ æˆæ–¹æ³•methodBçš„è¿”å›å€¼è¡¨ç¤ºæ˜¯å¦æ·»åŠ æˆåŠŸ
        BOOL isAdd = class_addMethod(self, selA,method_getImplementation(methodB),method_getTypeEncoding(methodB));
        //æ·»åŠ æˆåŠŸäº†è¯´æ˜æœ¬ç±»ä¸­ä¸å­˜åœ¨methodBæ‰€ä»¥æ­¤æ—¶å¿…é¡»å°†æ–¹æ³•bçš„å®ç°æŒ‡é’ˆæ¢æˆæ–¹æ³•Açš„ï¼Œå¦åˆ™bæ–¹æ³•å°†æ²¡æœ‰å®ç°ã€‚
        if(isAdd) {
            class_replaceMethod(self, selB,method_getImplementation(methodA),method_getTypeEncoding(methodA));
        }else{
            //æ·»åŠ å¤±è´¥äº†è¯´æ˜æœ¬ç±»ä¸­æœ‰methodBçš„å®ç°ï¼Œæ­¤æ—¶åªéœ€è¦å°†methodAå’ŒmethodBçš„IMPäº’æ¢ä¸€ä¸‹å³å¯ã€‚
            method_exchangeImplementations(methodA, methodB);
        }
    });
}

- (void)mySendAction:(SEL)action to:(id)target forEvent:(UIEvent*)event{
    if([NSStringFromClass(self.class) isEqualToString:@"UIButton"] &amp;&amp; !self.canResponseRepeatClick) {
        self.timeInterval = self.timeInterval == 0 ? defaultInterval:self.timeInterval;
        if(self.isIgnoreEvent){
            return;
        }else if(self.timeInterval &gt; 0){
            [self performSelector:@selector(resetState)withObject:nil afterDelay:self.timeInterval];
        }
    }
    //æ­¤å¤„methodAå’ŒmethodBæ–¹æ³•IMPäº’æ¢äº†ï¼Œå®é™…ä¸Šæ‰§è¡ŒsendActionï¼›æ‰€ä»¥ä¸ä¼šæ­»å¾ªç¯
    self.isIgnoreEvent = YES;
    [self mySendAction:action to:target forEvent:event];
}

@end

</code></pre></div></div>
:ET