I"ò<h4 id="æè¿°ä»¥uitextviewä¸ºä¾‹">æè¿°ä»¥<code class="language-plaintext highlighter-rouge">UITextView</code>ä¸ºä¾‹</h4>
<p>å½“<code class="language-plaintext highlighter-rouge">UITextView</code>å¤„äºç¼–è¾‘çŠ¶æ€æ—¶,å³é”®ç›˜å­˜åœ¨æ—¶,<code class="language-plaintext highlighter-rouge">UITextView</code>æ˜¯ç¬¬ä¸€å“åº”è€…,è€Œå½“éœ€è¦å¼¹å‡º<code class="language-plaintext highlighter-rouge">UIMenuController</code>æ—¶,ç¬¬ä¸€å“åº”è€…éœ€è¦å˜æ›´ä¸ºå¤„ç†<code class="language-plaintext highlighter-rouge">UIMenuController</code>èœå•äº‹ä»¶çš„å¯¹è±¡,æ­¤æ—¶UITextViewå°±ä¸æ˜¯ç¬¬ä¸€å“åº”è€…,é”®ç›˜å°±ä¼šéšè—,é€ æˆé”®ç›˜å’Œ<code class="language-plaintext highlighter-rouge">UIMenuController</code>ä¸èƒ½åŒæ—¶å‡ºç°.</p>

<h4 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h4>
<blockquote>
  <p>é€šè¿‡æ”¹å˜å“åº”é“¾æ¥è§£å†³:<br />
<strong>å‚è€ƒ</strong><br />
<a href="https://www.jianshu.com/p/2e074db792ba">iOSäº‹ä»¶å“åº”æœºåˆ¶</a><br />
<a href="https://www.jianshu.com/p/c294d1bd963d">iOSå“åº”é“¾å…¨å®¶æ¡¶</a><br />
åœ¨ä¿è¯<code class="language-plaintext highlighter-rouge">UITextVie</code>ç¬¬ä¸€å“åº”è€…çš„å‰æä¸‹,æˆ‘ä»¬å¯ä»¥è¦†ç›–æ”¹å˜<code class="language-plaintext highlighter-rouge">UITextView</code>çš„<code class="language-plaintext highlighter-rouge">nextResponder</code>,è®©<code class="language-plaintext highlighter-rouge">nextResponder</code>æŒ‡å‘<code class="language-plaintext highlighter-rouge">UIMenuController</code>èœå•äº‹ä»¶çš„æ‰§è¡Œè€…,åŒæ—¶ä¹Ÿè¦æ³¨æ„,åœ¨<code class="language-plaintext highlighter-rouge">UIMenuController</code>éšè—å,è¦å–æ¶ˆ<code class="language-plaintext highlighter-rouge">nextResponder</code>æŒ‡å‘,ä¸æ”¹å˜åŸæœ‰çš„å“åº”é“¾.</p>
</blockquote>

<h4 id="ä»£ç å®ç°">ä»£ç å®ç°</h4>

<p><strong>è‡ªå®šä¹‰<code class="language-plaintext highlighter-rouge">MYTextView</code></strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@interface MYTextView : UITextView
//è¦†ç›–ä¸‹ä¸€ä¸ªå“åº”è€…
@property (nonatomic, weak) UIResponder *overrideNextResponder; 
@end
@implementation MYTextView
- (UIResponder *)nextResponder {
    if(_overrideNextResponder == nil){
        return [super nextResponder];
    } else {
        return _overrideNextResponder;
    }
}
//UIMenuController èœå•å¯ä»¥æ‰§è¡Œæ“ä½œ
- (BOOL)canPerformAction:(SEL)action withSender:(id)sender {
    if (_overrideNextResponder != nil) {
        return NO;
    }
    return [super canPerformAction:action withSender:sender];
}
@end
</code></pre></div></div>

<p><strong>é•¿æŒ‰æ˜¾ç¤º<code class="language-plaintext highlighter-rouge">UIMenuController</code>çš„<code class="language-plaintext highlighter-rouge">VC</code></strong><br />
è¿™é‡Œä»¥é•¿æŒ‰<code class="language-plaintext highlighter-rouge">VC</code>ä¸­çš„<code class="language-plaintext highlighter-rouge">self.titleLabel</code>ä¸ºä¾‹:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//é•¿æŒ‰æ˜¾ç¤ºèœå• UIMenuController
- (void)longPressShowMenuView:(UILongPressGestureRecognizer *)longPress {
    //é¿å…é•¿æŒ‰å¤šæ¬¡æ‰§è¡Œ
    if (longPress.state != UIGestureRecognizerStateBegan) {
        return;
    }
    //ç¼–è¾‘è¿‡ç¨‹ä¸­ï¼Œself.textViewæ˜¯ç¬¬ä¸€å“åº”è€…
    if(self.textView.isFirstResponder){
        //å¦‚æœtextViewæ˜¯ç¬¬ä¸€å“åº”è€…ï¼Œåˆ™å¯¹titleLabelè¿›è¡Œå“åº”é“¾é€ä¼ ï¼Œè¦†ç›–self.textViewçš„ä¸‹ä¸€ä¸ªå“åº”è€…
        self.textView.overrideNextResponder = self.titleLabel;
        //æ·»åŠ èœå•éšè—çš„ç›‘å¬ï¼Œå½“èœå•éšè—æ—¶ï¼Œè¦é‡ç½®self.textView.overrideNextResponder = nil
        [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(menuViewDidHide:) name:UIMenuControllerDidHideMenuNotification object:nil];
    }else {
        //å¦‚æœå½“å‰æ— ç¬¬ä¸€å“åº”è€…ï¼Œå°±æˆä¸ºç¬¬ä¸€å“åº”è€…
        [self.titleLabel becomeFirstResponder];
    }
    
    UIMenuController *menuController = [UIMenuController sharedMenuController];
    UIMenuItem *saveItems = [[UIMenuItem alloc] initWithTitle:@"ä¿å­˜" action:@selector(save:)];
    UIMenuItem *noteItem = [[UIMenuItem alloc] initWithTitle:@"ç¬”è®°" action:@selector(note:)];
    menuController.menuItems = @[noteItem, saveItems];
    if (@available(iOS 13.0, *)) {
        [menuController showMenuFromView:self.view rect:self.titleLabel.frame];
    } else {
        [menuController setTargetRect:self.titleLabel.frame inView:self.view];
        [menuController setMenuVisible:YES animated:YES];
    }
}
//éšè—èœå•UIMenuControllerçš„é€šçŸ¥
- (void)menuViewDidHide:(NSNotification*)notification {
    //é‡ç½®ï¼Œä¸å½±å“åŸæœ‰çš„å“åº”é“¾
    self.textView.overrideNextResponder = nil;
    [[NSNotificationCenter defaultCenter] removeObserver:self name:UIMenuControllerDidHideMenuNotification object:nil];
}
</code></pre></div></div>

:ET