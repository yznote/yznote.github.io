I"k»<h4 id="coredata">CoreData</h4>

<h5 id="1coredataæ¦‚è¿°">1.CoreDataæ¦‚è¿°</h5>
<blockquote>
  <p>1.<code class="highlighter-rouge">Core data</code>æ˜¯æ•°æ®æŒä¹…å­˜å‚¨çš„æœ€ä½³æ–¹å¼<br />
2.<code class="highlighter-rouge">Core Data</code> åŸºäº<code class="highlighter-rouge">modelï¼viewï¼controllerï¼ˆmvcï¼‰</code>æ¨¡å¼ä¸‹ï¼Œä¸ºåˆ›å»ºåˆ†è§£çš„<code class="highlighter-rouge">cocoa</code>åº”ç”¨ç¨‹åºæä¾›äº†ä¸€ä¸ªçµæ´»å’Œå¼ºå¤§çš„æ•°æ®æ¨¡å‹æ¡†æ¶ã€‚<br />
3.<code class="highlighter-rouge">Core Data</code>å¯ä»¥æ˜¯ä½ ä»¥å›¾å½¢ç•Œé¢çš„æ–¹å¼å¿«é€Ÿçš„å®šä¹‰appçš„æ•°æ®æ¨¡å‹ï¼ŒåŒæ—¶åœ¨ä½ çš„ä»£ç ä¸­å®¹æ˜“è·å–åˆ°å®ƒã€‚ <code class="highlighter-rouge">Core Data</code>æä¾›äº†åŸºç¡€ç»“æ„å»å¤„ç†å¸¸ç”¨çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼š ä¿å­˜ï¼Œæ¢å¤ï¼Œæ’¤é”€å’Œé‡åšï¼Œå…è®¸ä½ åœ¨appä¸­ç»§ç»­åˆ›å»ºæ–°çš„ä»»åŠ¡ã€‚ åœ¨ä½¿ç”¨ <code class="highlighter-rouge">Core Data</code>çš„æ—¶å€™ï¼Œä½ ä¸ç”¨å®‰è£…é¢å¤–çš„æ•°æ®åº“ç³»ç»Ÿï¼Œå› ä¸º <code class="highlighter-rouge">Core Data</code>ä½¿ç”¨å†…ç½®çš„<code class="highlighter-rouge">SQLite</code>æ•°æ®åº“ã€‚ï¼ˆé‡Œé¢è‡ªåŠ¨ç”Ÿæˆä¸‰ä¸ªå­—æ®µï¼‰<br />
4.<code class="highlighter-rouge">Core Data</code>æä¾›äº†ä¸€ä¸ªé€šç”¨çš„æ•°æ®ç®¡ç†è§£å†³æ–¹æ¡ˆæ¥å¤„ç†é‚£äº›æ‰€æœ‰éœ€è¦æ•°æ®æ¨¡å‹çš„appï¼Œappä½¿ç”¨ <code class="highlighter-rouge">Core Data</code>æ¥ç®¡ç†æ•°æ®å¯¹è±¡æ—¶å¾ˆå¤šçš„ç›Šå¤„<br />
5.è‹¹æœçš„å›¾å½¢ç”¨æˆ·ç•Œé¢ç¼–è¯‘å™¨<code class="highlighter-rouge">-interface builderï¼ˆIBï¼‰</code>ï¼Œæä¾›äº†å¯¹<code class="highlighter-rouge">core data controller</code>å¯¹è±¡çš„é¢„æ„å»ºï¼Œä»è€Œæ¥å‡å°‘appçš„ç”¨æˆ·ç•Œé¢å’Œå®ƒçš„æ•°æ®æ¨¡å‹ä¹‹é—´çš„ç²˜æ»ä»£ç ã€‚åœ¨ä½¿ç”¨<code class="highlighter-rouge">core data</code>çš„æ—¶å€™ä½ ä¸éœ€è¦è€ƒè™‘<code class="highlighter-rouge">sql</code>çš„è¯­æ³•é—®é¢˜ï¼Œä¹Ÿä¸éœ€è¦ç®¡ç†ç›¸å…³çš„é€»è¾‘æ ‘å»è¿½è¸ªç”¨æˆ·çš„è¡Œä¸ºï¼Œæ›´ä¸ç”¨å»ºç«‹æ–°çš„æ°¸ä¹…æœºåˆ¶ã€‚å½“ä½ å†™ä½ appçš„ç”¨æˆ·ç•Œé¢åˆ°å®ƒçš„<code class="highlighter-rouge">core data</code>æ¨¡å‹çš„æ—¶å€™ï¼Œå®ƒå·²ç»ä¸ºä½ æŠŠæ‰€æœ‰çš„ä¸œè¥¿éƒ½åšå¥½äº†ã€‚<br />
6.<code class="highlighter-rouge">core data</code>å°†ä½ appçš„æ¨¡å‹å±‚æ”¾å…¥åˆ°ä¸€ç»„å®šä¹‰åœ¨å†…å­˜ä¸­çš„æ•°æ®å¯¹è±¡ã€‚<code class="highlighter-rouge">core data</code>ä¼šè¿½è¸ªè¿™äº›å¯¹è±¡çš„æ”¹å˜ï¼ŒåŒæ—¶å¯ä»¥æ ¹æ®éœ€è¦åšç›¸åçš„æ”¹å˜ï¼Œä¾‹å¦‚ç”¨æˆ·æ‰§è¡Œæ’¤é”€å‘½ä»¤ã€‚å½“<code class="highlighter-rouge">core data</code>åœ¨å¯¹ä½ appæ•°æ®çš„æ”¹å˜è¿›è¡Œä¿å­˜çš„æ—¶å€™ï¼Œ<code class="highlighter-rouge">core data</code>ä¼šæŠŠè¿™äº›æ•°æ®å½’æ¡£ï¼Œå¹¶æ°¸ä¹…æ€§ä¿å­˜ã€‚å®ƒä¿å­˜çš„æ•°æ®åœ¨ä¸€äº›å¸¸è§„çš„æ–‡ä»¶ï¼Œä½ å¯ä»¥åœ¨<code class="highlighter-rouge">Finder</code>ä¸­å¯ä»¥è¿›è¡Œç®¡ç†ï¼Œç”¨<code class="highlighter-rouge">spotlight</code>è¿›è¡Œæœç´¢ï¼Œå¤‡ä»½åˆ°cdï¼Œå’Œ<code class="highlighter-rouge">email</code>ç»™æœ‹å‹æˆ–è€…å®¶äºº ã€‚<br />
7.åœ¨ä½¿ç”¨<code class="highlighter-rouge">core data</code>æ¡†æ¶çš„æ—¶å€™ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªç®¡ç†å¯¹è±¡çš„æ¨¡å‹ï¼Œè¯¥æ¨¡å‹æä¾›äº†å¯¹æ¨¡å‹å¯¹è±¡çš„æŠ½è±¡å®šä¹‰ï¼Œè¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€çŸ¥é“çš„<code class="highlighter-rouge">entities</code>ï¼Œå®ƒå¯ä»¥åœ¨æˆ‘ä»¬çš„ç¨‹åºä¸­ä½¿ç”¨ã€‚<br />
8.<code class="highlighter-rouge">core data</code>æ˜¯ä¸€ä¸ªå®ä½“-å…³ç³»æ¨¡å‹ ï¼Œè¯¥æ¨¡å‹æ˜¯ä½¿ç”¨Xcodeçš„æ•°æ®æ¨¡å‹è®¾è®¡å·¥å…·æ¥å®šä¹‰çš„ï¼Œå¯¹æ•°æ®å®ä½“ä»¥åŠä»–ä»¬çš„å…³ç³»æä¾›äº†ä¸°å¯Œçš„ç¯å¢ƒã€‚</p>
</blockquote>

<h5 id="2coredataçš„æ„æˆåŠç‰¹ç‚¹">2.CoreDataçš„æ„æˆåŠç‰¹ç‚¹</h5>
<blockquote>
  <p>1.æ•°æ®æœ€ç»ˆçš„å­˜å‚¨ç±»å‹
<code class="highlighter-rouge">SQLite</code>æ•°æ®åº“ï¼Œ<code class="highlighter-rouge">XML</code>ï¼ŒäºŒè¿›åˆ¶ï¼Œå†…å­˜é‡Œï¼Œæˆ–è‡ªå®šä¹‰æ•°æ®ç±»å‹ï¼ˆ åœ¨ <code class="highlighter-rouge">Mac OS X 10.5Leopard</code>åŠä»¥åçš„ç‰ˆæœ¬ä¸­ï¼Œå¼€å‘è€…ä¹Ÿå¯ä»¥é€šè¿‡ç»§æ‰¿ <code class="highlighter-rouge">NSPersistentStore</code> ç±»ä»¥åˆ›å»ºè‡ªå®šä¹‰çš„å­˜å‚¨æ ¼å¼ï¼‰<br />
2.å¥½å¤„<br />
èƒ½å¤Ÿåˆç†ç®¡ç†å†…å­˜ï¼Œé¿å…ä½¿ç”¨<code class="highlighter-rouge">sql</code>çš„éº»çƒ¦ï¼Œé«˜æ•ˆ<br />
3.æ„æˆ</p>
  <ol>
    <li><code class="highlighter-rouge">NSManagedObjectContext</code>ï¼ˆè¢«ç®¡ç†çš„æ•°æ®ä¸Šä¸‹æ–‡ï¼‰
  æ“ä½œå®é™…å†…å®¹ï¼ˆæ“ä½œæŒä¹…å±‚ï¼‰
  ä½œç”¨ï¼šæ’å…¥æ•°æ®ï¼ŒæŸ¥è¯¢æ•°æ®ï¼Œåˆ é™¤æ•°æ®</li>
    <li><code class="highlighter-rouge">NSManagedObjectModel</code>ï¼ˆè¢«ç®¡ç†çš„æ•°æ®æ¨¡å‹ï¼‰<br />
  æ•°æ®åº“æ‰€æœ‰è¡¨æ ¼æˆ–æ•°æ®ç»“æ„ï¼ŒåŒ…å«å„å®ä½“çš„å®šä¹‰ä¿¡æ¯<br />
  ä½œç”¨ï¼šæ·»åŠ å®ä½“çš„å±æ€§ï¼Œå»ºç«‹å±æ€§ä¹‹é—´çš„å…³ç³»<br />
  æ“ä½œæ–¹æ³•ï¼šè§†å›¾ç¼–è¾‘å™¨ï¼Œæˆ–ä»£ç </li>
    <li><code class="highlighter-rouge">NSPersistentStoreCoordinator</code>ï¼ˆæŒä¹…åŒ–å­˜å‚¨åŠ©ç†ï¼‰<br />
  ç›¸å½“äºæ•°æ®åº“çš„è¿æ¥å™¨<br />
  ä½œç”¨ï¼šè®¾ç½®æ•°æ®å­˜å‚¨çš„åå­—ï¼Œä½ç½®ï¼Œå­˜å‚¨æ–¹å¼ï¼Œå’Œå­˜å‚¨æ—¶æœº</li>
    <li><code class="highlighter-rouge">NSManagedObject</code>ï¼ˆè¢«ç®¡ç†çš„æ•°æ®è®°å½•ï¼‰<br />
  ç›¸å½“äºæ•°æ®åº“ä¸­çš„è¡¨æ ¼è®°å½•</li>
    <li><code class="highlighter-rouge">NSFetchRequest</code>ï¼ˆè·å–æ•°æ®çš„è¯·æ±‚ï¼‰<br />
  ç›¸å½“äºæŸ¥è¯¢è¯­å¥</li>
    <li><code class="highlighter-rouge">NSEntityDescription</code>ï¼ˆå®ä½“ç»“æ„ï¼‰<br />
  ç›¸å½“äºè¡¨æ ¼ç»“æ„</li>
    <li>åç¼€ä¸º<code class="highlighter-rouge">.xcdatamodeld</code>çš„åŒ…<br />
  é‡Œé¢æ˜¯<code class="highlighter-rouge">.xcdatamodel</code>æ–‡ä»¶ï¼Œç”¨æ•°æ®æ¨¡å‹ç¼–è¾‘å™¨ç¼–è¾‘<br />
  ç¼–è¯‘åä¸º<code class="highlighter-rouge">.momd</code>æˆ–<code class="highlighter-rouge">.mom</code>æ–‡ä»¶</li>
  </ol>

  <p>4.ä¾èµ–å…³ç³»<br />
<img src="/img/noimg.jpeg" alt="æ–°æµªåšå®¢çš„å›¾ç‰‡ä¸¢å¤±äº†" /></p>
</blockquote>
<center style="color: #969696">æ–°æµªåšå®¢çš„åŸå§‹å›¾ç‰‡ä¸¢å¤±äº†</center>

<h5 id="3åŸºäºsqliteæ•°æ®åº“æ—¶core-dataçš„ç®€å•ä½¿ç”¨">3.åŸºäº<code class="highlighter-rouge">SQLite</code>æ•°æ®åº“æ—¶ï¼Œ<code class="highlighter-rouge">Core Data</code>çš„ç®€å•ä½¿ç”¨</h5>

<blockquote>
  <p>å’Œ<code class="highlighter-rouge">SQLite</code>çš„åŒºåˆ«ï¼šåªèƒ½å–å‡ºæ•´ä¸ªå®ä½“è®°å½•ï¼Œç„¶ååˆ†è§£ï¼Œä¹‹åæ‰èƒ½å¾—åˆ°å®ä½“çš„æŸä¸ªå±æ€§</p>
</blockquote>

<blockquote>
  <p>.1 æ„å»ºæµç¨‹  <br />
åŒ…æ‹¬ï¼šåˆ›å»ºæ•°æ®ä¸Šä¸‹æ–‡ï¼Œåˆ›å»ºæ•°æ®æ¨¡å‹ï¼Œåˆ›å»ºæ•°æ®æŒä¹…åŒ–å­˜å‚¨åŠ©ç†</p>
  <ol>
    <li>è‹¥æ˜¯æ–°å»ºçš„å·¥ç¨‹ï¼Œé€‰æ‹©ç©ºç™½åº”ç”¨ç¨‹åºï¼Œ<code class="highlighter-rouge">next</code>  <br />
  <img src="/img/noimg.jpeg" alt="æ–°æµªåšå®¢çš„å›¾ç‰‡ä¸¢å¤±äº†" />
  æ­¤æ—¶ç”Ÿæˆçš„å·¥ç¨‹æ–‡ä»¶AppDelegateä¸­ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆè¢«ç®¡ç†çš„æ•°æ®ä¸Šä¸‹æ–‡ç­‰ç›¸å…³ä»£ç </li>
    <li>æ¯”å¦‚<code class="highlighter-rouge">AppDelegate.h</code>æ–‡ä»¶ä¸­ï¼Œè‡ªåŠ¨ç”Ÿæˆ
      <div class="language-obj-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">@property</span> <span class="p">(</span> <span class="n">readonly</span> <span class="p">,</span> <span class="n">strong</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">NSManagedObjectContext</span> <span class="o">*</span><span class="n">managedObjectContext</span><span class="p">;</span>
  <span class="k">@property</span> <span class="p">(</span> <span class="n">readonly</span> <span class="p">,</span> <span class="n">strong</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">NSManagedObjectModel</span> <span class="o">*</span><span class="n">managedObjectModel</span><span class="p">;</span>
  <span class="k">@property</span> <span class="p">(</span> <span class="n">readonly</span> <span class="p">,</span> <span class="n">strong</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">NSPersistentStoreCoordinator</span> <span class="o">*</span><span class="n">persistentStoreCoordinator</span><span class="p">;</span>
  <span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">saveContext</span><span class="p">;</span>
  <span class="k">-</span> <span class="p">(</span><span class="n">NSURL</span> <span class="o">*</span><span class="p">)</span><span class="n">applicationDocumentsDirectory</span><span class="p">;</span>
  <span class="c1">//æ–¹æ³•`saveContext`è¡¨ç¤ºï¼šä¿å­˜æ•°æ®åˆ°æŒä¹…å±‚ï¼ˆæ•°æ®åº“ï¼‰  </span>
  <span class="c1">//æ–¹æ³•`applicationDocumentsDirectory`è¡¨ç¤ºï¼šåº”ç”¨ç¨‹åºæ²™ç®±ä¸‹çš„`Documents`ç›®å½•è·¯å¾„</span>
  <span class="c1">//( ä¾‹å¦‚/var/mobile/Applications/5FG80A45-DFB5-4087-A1B1-41342A977E21/Documents/ )</span>
</code></pre></div>      </div>
    </li>
    <li>æ¯”å¦‚AppDelegate.hæ–‡ä»¶ä¸­ï¼Œè‡ªåŠ¨ç”Ÿæˆ
      <div class="language-obj-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">@synthesize</span> <span class="n">managedObjectContext</span> <span class="o">=</span> <span class="n">__managedObjectContext</span><span class="p">;</span>
  <span class="k">@synthesize</span> <span class="n">managedObjectModel</span> <span class="o">=</span> <span class="n">__managedObjectModel</span><span class="p">;</span>
  <span class="k">@synthesize</span> <span class="n">persistentStoreCoordinator</span> <span class="o">=</span> <span class="n">__persistentStoreCoordinator</span><span class="p">;</span>
  <span class="c1">//ä¿å­˜æ•°æ®åˆ°æŒä¹…å±‚</span>
  <span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">applicationWillTerminate</span><span class="p">:(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span><span class="p">{</span>
    	<span class="p">[</span><span class="n">self</span> <span class="nf">saveContext</span><span class="p">];</span>
  <span class="p">}</span>
</code></pre></div>      </div>
      <p><img src="/img/noimg.jpeg" alt="æ–°æµªåšå®¢çš„å›¾ç‰‡ä¸¢å¤±äº†" /></p>
      <div class="language-obj-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">-</span> <span class="p">(</span> <span class="kt">void</span> <span class="p">)</span><span class="n">saveContext</span>  <span class="p">{</span>
    <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="n">NSManagedObjectContext</span> <span class="o">*</span><span class="n">managedObjectContext</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">managedObjectContext</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">managedObjectContext</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">if</span> <span class="p">([</span><span class="n">managedObjectContext</span> <span class="nf">hasChanges</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">[</span><span class="n">managedObjectContext</span> <span class="nf">save</span><span class="p">:</span><span class="o">&amp;</span><span class="n">error</span><span class="p">])</span> <span class="p">{</span>
       <span class="n">NSLog</span><span class="p">(</span> <span class="s">@"Unresolved error %@, %@"</span> <span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="p">[</span><span class="n">error</span> <span class="nf">userInfo</span><span class="p">]);</span>
       <span class="n">abort</span><span class="p">();</span>
   <span class="p">}</span> 
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div>      </div>
      <p><img src="/img/noimg.jpeg" alt="æ–°æµªåšå®¢çš„å›¾ç‰‡ä¸¢å¤±äº†" /></p>
      <div class="language-obj-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1">//Documentsç›®å½•è·¯å¾„</span>
  <span class="k">-</span> <span class="p">(</span><span class="n">NSURL</span> <span class="o">*</span><span class="p">)</span><span class="n">applicationDocumentsDirectory</span> <span class="p">{</span>
 <span class="k">return</span> <span class="p">[[[</span><span class="n">NSFileManager</span> <span class="nf">defaultManager</span><span class="p">]</span> <span class="nf">URLsForDirectory</span><span class="p">:</span><span class="n">NSDocumentDirectory</span> <span class="nf">inDomains</span><span class="p">:</span><span class="nf">NSUserDomainMask</span><span class="p">]</span> <span class="n">lastObject</span><span class="p">];</span>
  <span class="p">}</span>
</code></pre></div>      </div>
      <p><img src="/img/noimg.jpeg" alt="æ–°æµªåšå®¢çš„å›¾ç‰‡ä¸¢å¤±äº†" /></p>
      <div class="language-obj-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1">//è¢«ç®¡ç†çš„æ•°æ®ä¸Šä¸‹æ–‡</span>
  <span class="c1">//åˆå§‹åŒ–çš„åï¼Œå¿…é¡»è®¾ç½®æŒä¹…åŒ–å­˜å‚¨åŠ©ç†</span>
  <span class="k">-</span> <span class="p">(</span><span class="n">NSManagedObjectContext</span> <span class="o">*</span><span class="p">)</span><span class="n">managedObjectContext</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">__managedObjectContext</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">return</span> <span class="n">__managedObjectContext</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">NSPersistentStoreCoordinator</span> <span class="o">*</span><span class="n">coordinator</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">persistentStoreCoordinator</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">coordinator</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">__managedObjectContext</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSManagedObjectContext</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
   <span class="p">[</span><span class="n">__managedObjectContext</span> <span class="nf">setPersistentStoreCoordinator</span><span class="p">:</span><span class="n">coordinator</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">__managedObjectContext</span><span class="p">;</span>
  <span class="p">}</span>
</code></pre></div>      </div>
      <p><img src="/img/noimg.jpeg" alt="æ–°æµªåšå®¢çš„å›¾ç‰‡ä¸¢å¤±äº†" /></p>
      <div class="language-obj-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1">//è¢«ç®¡ç†çš„æ•°æ®æ¨¡å‹</span>
  <span class="c1">//åˆå§‹åŒ–å¿…é¡»ä¾èµ–.momdæ–‡ä»¶è·¯å¾„ï¼Œè€Œ.momdæ–‡ä»¶ç”±.xcdatamodeldæ–‡ä»¶ç¼–è¯‘è€Œæ¥</span>
  <span class="k">-</span> <span class="p">(</span><span class="n">NSManagedObjectModel</span> <span class="o">*</span><span class="p">)</span><span class="n">managedObjectModel</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">__managedObjectModel</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
    	<span class="k">return</span> <span class="n">__managedObjectModel</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">NSURL</span> <span class="o">*</span><span class="n">modelURL</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSBundle</span> <span class="nf">mainBundle</span><span class="p">]</span> <span class="nf">URLForResource</span><span class="p">:</span> <span class="s">@"TestApp"</span><span class="nf">withExtension</span><span class="p">:</span> <span class="s">@"momd"</span> <span class="p">];</span>
    <span class="n">__managedObjectModel</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSManagedObjectModel</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithContentsOfURL</span><span class="p">:</span><span class="n">modelURL</span><span class="p">];</span>
    <span class="k">return</span> <span class="n">__managedObjectModel</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">//æŒä¹…åŒ–å­˜å‚¨åŠ©ç†</span>
  <span class="c1">//åˆå§‹åŒ–å¿…é¡»ä¾èµ–NSManagedObjectModelï¼Œä¹‹åè¦æŒ‡å®šæŒä¹…åŒ–å­˜å‚¨çš„æ•°æ®ç±»å‹ï¼Œé»˜è®¤çš„æ˜¯NSSQLiteStoreTypeï¼Œå³SQLiteæ•°æ®åº“ï¼›å¹¶æŒ‡å®šå­˜å‚¨è·¯å¾„ä¸ºDocumentsç›®å½•ä¸‹ï¼Œä»¥åŠæ•°æ®åº“åç§°</span>
  <span class="k">-</span> <span class="p">(</span><span class="n">NSPersistentStoreCoordinator</span> <span class="o">*</span><span class="p">)</span><span class="n">persistentStoreCoordinator</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">__persistentStoreCoordinator</span> <span class="o">!=</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">return</span> <span class="n">__persistentStoreCoordinator</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">NSURL</span> <span class="o">*</span><span class="n">storeURL</span> <span class="o">=</span> <span class="p">[[</span><span class="n">self</span> <span class="nf">applicationDocumentsDirectory</span><span class="p">]</span> <span class="nf">URLByAppendingPathComponent</span><span class="p">:</span> <span class="s">@"TestApp.SQLite"</span> <span class="p">];</span>
    <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="n">__persistentStoreCoordinator</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSPersistentStoreCoordinator</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithManagedObjectModel</span><span class="p">:[</span><span class="n">self</span> <span class="nf">managedObjectModel</span><span class="p">]];</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">[</span><span class="n">__persistentStoreCoordinator</span> <span class="nf">addPersistentStoreWithType</span><span class="p">:</span><span class="n">NSSQLiteStoreType</span> <span class="nf">configuration</span><span class="p">:</span><span class="nb">nil</span> <span class="n">URL</span><span class="o">:</span><span class="n">storeURL</span> <span class="n">options</span><span class="o">:</span><span class="nb">nil</span> <span class="n">error</span><span class="o">:&amp;</span><span class="n">error</span><span class="p">])</span> <span class="p">{</span>
   <span class="n">NSLog</span><span class="p">(</span> <span class="s">@"Unresolved error %@, %@"</span> <span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="p">[</span><span class="n">error</span> <span class="nf">userInfo</span><span class="p">]);</span>
   <span class="n">abort</span><span class="p">();</span>
    <span class="p">}</span>  
    <span class="k">return</span> <span class="n">__persistentStoreCoordinator</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">//å¦‚æœä¸æ˜¯æ–°å·¥ç¨‹ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å†™å…¥ç›¸å…³ä»£ç </span>
</code></pre></div>      </div>
    </li>
    <li>æ­¤å¤–è¿˜ç”Ÿæˆäº†<code class="highlighter-rouge">TestApp.xcdatamodeld</code>æ–‡ä»¶</li>
    <li>è¿˜è‡ªåŠ¨é“¾æ¥äº†<code class="highlighter-rouge">CoreData.framework</code></li>
    <li>åœ¨é¢„ç¼–è¯‘å¤´.pchæ–‡ä»¶ä¸­ï¼ŒåŠ å…¥å¯¼å…¥äº†CoreData.hå¤´æ–‡ä»¶</li>
  </ol>

  <p>2.åˆ›å»ºæ•°æ®æ¨¡å‹ï¼ˆæ•°æ®æ¨¡å‹ç¼–è¾‘å™¨æ“ä½œï¼‰</p>
  <ol>
    <li>åˆ›å»ºå®ä½“ï¼ˆæ•°æ®åº“è¡¨ï¼‰å’Œå®ä½“é—´çš„å…³ç³»<br />
  é€‰ä¸­<code class="highlighter-rouge">.xcodedatamodel</code>å¯¹è±¡<br />
  åœ¨å·¦ä¸‹è„šç‚¹å‡»<code class="highlighter-rouge">Add Entity</code>æ·»åŠ å®ä½“<br />
  é€‰ä¸­æ–°æ·»åŠ çš„å±æ€§ï¼Œå¯¹å±æ€§è¿›è¡Œå‘½åï¼Œå¹¶è®¾ç½®å±æ€§çš„æ•°æ®ç±»å‹<code class="highlighter-rouge">Attribute Type</code><br />
  é€‰ä¸­ä¸€ä¸ªå®ä½“ï¼Œåœ¨åº•éƒ¨å·¥å…·æ ç‚¹å‡»<code class="highlighter-rouge">Add Relationship</code>æ·»åŠ å…³ç³»<br />
  <img src="/img/noimg.jpeg" alt="æ–°æµªåšå®¢çš„å›¾ç‰‡ä¸¢å¤±äº†" /></li>
    <li>è‡ªåŠ¨ç”Ÿæˆæ¨¡å‹ç±»
  <img src="/img/noimg.jpeg" alt="æ–°æµªåšå®¢çš„å›¾ç‰‡ä¸¢å¤±äº†" />
  é€‰æ‹©ä½ è¦åˆ›å»ºçš„æ•°æ®å¯¹è±¡
  <img src="/img/noimg.jpeg" alt="æ–°æµªåšå®¢çš„å›¾ç‰‡ä¸¢å¤±äº†" /></li>
  </ol>

  <p>3.æ•°æ®æ¨¡ç‰ˆ<br />
ä¸ºæ¯ä¸ªå®ä½“ç”Ÿæˆä¸€ä¸ª<code class="highlighter-rouge">NSManagedObject</code>å­ç±»<br />
ä¸Šé¢è®¾ç½®æ•°æ®å’Œè·å–æ•°æ®æ—¶ï¼Œä½¿ç”¨çš„æ˜¯<code class="highlighter-rouge">Key-Value</code>æ–¹å¼ï¼Œæ›´å¥½çš„æ–¹æ³•æ˜¯é€šè¿‡ç”Ÿæˆå¼ºç±»å‹çš„<code class="highlighter-rouge">NSManagedObject</code>çš„å­ç±»ï¼Œé€šè¿‡ç±»çš„æˆå‘˜å±æ€§æ¥è®¿é—®å’Œè·å–æ•°æ®</p>
  <ol>
    <li>åœ¨æ•°æ®ç¼–è¾‘å™¨è§†å›¾ä¸­é€‰ä¸­å®ä½“å¯¹è±¡<br />
  é€‰åˆ™<code class="highlighter-rouge">file</code>èœå•ï¼Œç‚¹å‡»<code class="highlighter-rouge">new</code>ï¼Œç‚¹å‡»<code class="highlighter-rouge">file...</code>ï¼Œé€‰æ‹©<code class="highlighter-rouge">Core Data</code>é¡¹ï¼Œé€‰æ‹©<code class="highlighter-rouge">NSManagedObject subclass</code>ï¼Œç”Ÿæˆè¯¥å®ä½“åŒåçš„ç±»ï¼Œ<br />
  ç»§æ‰¿äº<code class="highlighter-rouge">NSManagedObject</code><br />
  ç”Ÿæˆå¯¹åº”çš„<code class="highlighter-rouge">.h</code>æ–‡ä»¶
  <img src="/img/noimg.jpeg" alt="æ–°æµªåšå®¢çš„å›¾ç‰‡ä¸¢å¤±äº†" />
  ç”Ÿæˆå¯¹åº”çš„<code class="highlighter-rouge">.m</code>æ–‡ä»¶
  <img src="/img/noimg.jpeg" alt="æ–°æµªåšå®¢çš„å›¾ç‰‡ä¸¢å¤±äº†" />
  å…¶ä¸­ï¼Œ<code class="highlighter-rouge">@dynamic</code>å‘Šè¯‰ç¼–è¯‘å™¨ä¸åšå¤„ç†ï¼Œä½¿ç¼–è¯‘é€šè¿‡ï¼Œå…¶<code class="highlighter-rouge">getter</code>å’Œ<code class="highlighter-rouge">setter</code>æ–¹æ³•ä¼šåœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºï¼Œç”±<code class="highlighter-rouge">Core Data</code>æ¡†æ¶ä¸ºæ­¤ç±»å±æ€§ç”Ÿæˆå­˜å–æ–¹æ³•</li>
  </ol>

  <p>4.æ’å…¥æ•°æ®<br />
åœ¨<code class="highlighter-rouge">AppDelegate.m</code>çš„<code class="highlighter-rouge">application:didFinishLaunchingWithOptions:</code>æ–¹æ³•é‡Œï¼Œè°ƒç”¨è‡ªå®šä¹‰æ–¹æ³•
<code class="highlighter-rouge">insertCoreData</code>æ’å…¥æ•°æ®ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
  <div class="language-obj-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">-</span> <span class="p">(</span> <span class="kt">void</span> <span class="p">)</span><span class="n">insertCoreData</span> <span class="p">{</span>
    <span class="n">NSManagedObjectContext</span> <span class="o">*</span><span class="n">context</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">managedObjectContext</span><span class="p">];</span>
    <span class="n">NSManagedObject</span> <span class="o">*</span><span class="n">contactInfo</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSEntityDescription</span> <span class="nf">insertNewObjectForEntityForName</span><span class="p">:</span> <span class="s">@"School"</span> <span class="nf">inManagedObjectContext</span><span class="p">:</span><span class="n">context</span><span class="p">];</span>
    <span class="p">[</span><span class="n">contactInfo</span> <span class="nf">setValue</span><span class="p">:</span> <span class="s">@"name B"</span> <span class="nf">forKey</span><span class="p">:</span> <span class="s">@"name"</span> <span class="p">];</span>
    <span class="p">[</span><span class="n">contactInfo</span> <span class="nf">setValue</span><span class="p">:</span> <span class="s">@"classID 1"</span> <span class="nf">forKey</span><span class="p">:</span> <span class="s">@"classID"</span> <span class="p">];</span>
    <span class="p">[</span><span class="n">contactInfo</span> <span class="nf">setValue</span><span class="p">:</span> <span class="s">@"persons 20"</span> <span class="nf">forKey</span><span class="p">:</span> <span class="s">@"pensons"</span> <span class="p">];</span>
    <span class="n">NSManagedObject</span> <span class="o">*</span><span class="n">contactDetailInfo</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSEntityDescription</span> <span class="nf">insertNewObjectForEntityForName</span><span class="p">:</span> <span class="s">@"ContactDetailInfo"</span><span class="nf">inManagedObjectContext</span><span class="p">:</span><span class="n">context</span><span class="p">];</span>
    <span class="p">[</span><span class="n">contactDetailInfo</span> <span class="nf">setValue</span><span class="p">:</span> <span class="s">@"age 22"</span> <span class="nf">forKey</span><span class="p">:</span> <span class="s">@"age"</span> <span class="p">];</span>
    <span class="p">[</span><span class="n">contactDetailInfo</span> <span class="nf">setValue</span><span class="p">:</span> <span class="s">@"name B"</span> <span class="nf">forKey</span><span class="p">:</span> <span class="s">@"name"</span> <span class="p">];</span>
    <span class="p">[</span><span class="n">contactDetailInfo</span> <span class="nf">setValue</span><span class="p">:</span> <span class="s">@"classID 1"</span> <span class="nf">forKey</span><span class="p">:</span> <span class="s">@"classID"</span> <span class="p">];</span>
    <span class="p">[</span><span class="n">contactDetailInfo</span> <span class="nf">setValue</span><span class="p">:</span><span class="n">contactInfo</span> <span class="nf">forKey</span><span class="p">:</span> <span class="s">@"name"</span> <span class="p">];</span>
    <span class="p">[</span><span class="n">contactInfo</span> <span class="nf">setValue</span><span class="p">:</span><span class="n">contactDetailInfo</span> <span class="nf">forKey</span><span class="p">:</span> <span class="s">@"classID"</span> <span class="p">];</span>
    <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">[</span><span class="n">context</span> <span class="nf">save</span><span class="p">:</span><span class="o">&amp;</span><span class="n">error</span><span class="p">])</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span> <span class="s">@"ä¸èƒ½ä¿å­˜ï¼š%@"</span> <span class="p">,[</span><span class="n">error</span> <span class="nf">localizedDescription</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>  </div>
  <p>åˆ›å»ºæ•°æ®ä¸Šä¸‹æ–‡ï¼Œè°ƒç”¨<code class="highlighter-rouge">insertNewObjectForName</code>æ–¹æ³•ï¼Œåˆ›å»ºä¸¤ä¸ªæ•°æ®è®°å½•<code class="highlighter-rouge">NSManagedObject</code>ï¼Œç„¶åå°±å¯ä»¥å¯¹ä¹‹å‰æ•°æ®æ¨¡å‹ç¼–è¾‘è§†å›¾ä¸­å®šä¹‰çš„å±æ€§è¿›è¡Œèµ‹å€¼ã€‚æ­¤æ—¶çš„æ•°æ®åªåœ¨å†…å­˜ä¸­è¢«ä¿®æ”¹ï¼Œæœ€åè°ƒç”¨æ•°æ®ä¸Šä¸‹æ–‡çš„<code class="highlighter-rouge">save</code>æ–¹æ³•ï¼Œä¿å­˜åˆ°æŒä¹…å±‚
5.æŸ¥è¯¢æ•°æ®<br />
åœ¨è°ƒç”¨äº†<code class="highlighter-rouge">insertCoreData</code>ä¹‹åï¼Œå¯ä»¥è°ƒç”¨è‡ªå®šçš„æŸ¥è¯¢æ–¹æ³•<code class="highlighter-rouge">dataFetchRequest</code>æ¥æŸ¥è¯¢æ’å…¥çš„æ•°æ®</p>
</blockquote>

<ul>
  <li>( void )dataFetchRequest</li>
</ul>

<p>{</p>

<p>NSManagedObjectContext *context = [self managedObjectContext];</p>

<p>NSFetchRequest *fetchRequest = [[[NSFetchRequest alloc] init] autorelease];</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NSEntityDescription *entity = [NSEntityDescription entityForName:@"ContactInfo" inManagedObjectContext:context];
</code></pre></div></div>

<p>[fetchRequest setEntity:entity];</p>

<p>NSError *error;</p>

<p>NSArray *fetchedObjects = [context executeFetchRequest:fetchRequest error:&amp;error];</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>for (NSManagedObject *info in fetchedObjects) {

    NSLog( @"classID:%d" , [info valueForKey: @"classID" ]);

    NSLog( @"persons:%d" , [info valueForKey: @"persons" ]);

    NSLog( @"name:%@" , [info valueForKey: @"name" ]);

    NSManagedObject *details = [info valueForKey: @"name" ];

    NSLog( @"age:%d" , [details valueForKey: @"age" ]);

     NSLog( @"classID:%d" , [details valueForKey: @"classID" ]);
</code></pre></div></div>

<p>}</p>

<p>}</p>

<p>fetchRequestç›¸å½“äºsqlæŸ¥è¯¢è¯­å¥çš„åŒ…è£…ç±»ï¼Œéœ€è¦ç”¨setEntityæ–¹æ³•ï¼Œæ¥æŒ‡å®šå…·ä½“æŸ¥è¯¢çš„å®ä½“ç»“æ„ï¼ˆè¡¨ç»“æ„ï¼‰</p>

<p>é€šè¿‡NSEntityDescriptionçš„entityForNameæ–¹æ³•æ¥ï¼Œè¿”å›æŒ‡å‘è¯¥å…·ä½“å®ä½“ç»“æ„çš„æŒ‡é’ˆ</p>

<p>ç„¶åè°ƒç”¨executeFetchRequest:error:æ–¹æ³•ï¼Œæ¥æ‰§è¡ŒæŸ¥è¯¢æ“ä½œï¼Œå¦‚æœæ“ä½œæˆåŠŸï¼Œåˆ™è¿”å›å¯¹åº”çš„æ•°æ®è®°å½•æ•°ç»„</p>

<p>å…¶ä¸­ï¼Œå¯ä»¥é€šè¿‡NSManagedObjectæ•°æ®è®°å½•å¯¹è±¡é‡Œå…³è”çš„å±æ€§ï¼ŒæŸ¥è¯¢å¦ä¸€ä¸ªæ•°æ®è®°å½•å¯¹è±¡é‡Œçš„å±æ€§</p>

<p>ä¹‹å‰ç”¨Key-Valueçš„ä»£ç å°±å¯ä»¥ä¿®æ”¹ä¸ºï¼š</p>

<p>#import â€œSchool.hâ€</p>

<p>#import â€œStudent.hâ€</p>

<ul>
  <li>( void )insertCoreData</li>
</ul>

<p>{</p>

<p>NSManagedObjectContext *context = [self managedObjectContext];</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ContactInfo *contactInfo = [NSEntityDescription insertNewObjectForEntityForName: @"School" inManagedObjectContext:context];

contactInfo.name = @"name B" ;

contactInfo.birthday = @"classID 0" ;

contactInfo.age = @"persons 20" ;

ContactDetailInfo *contactDetailInfo = [NSEntityDescription insertNewObjectForEntityForName: @"Student" inManagedObjectContext:context];

contactDetailInfo.address = @"age 22" ;

contactDetailInfo.name = @"name B" ;

contactDetailInfo.telephone = @"classID 1" ;
</code></pre></div></div>

<p>contactDetailInfo.info = contactInfo;</p>

<p>contactInfo.details = contactDetailInfo;</p>

<p>NSError *error;</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if (![context save:&amp;error])
</code></pre></div></div>

<p>{</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    NSLog( @"ä¸èƒ½ä¿å­˜ï¼š%@" ,[error localizedDescription]);
</code></pre></div></div>

<p>}</p>

<p>}</p>

<ul>
  <li>( void )dataFetchRequest</li>
</ul>

<p>{</p>

<p>NSManagedObjectContext *context = [self managedObjectContext];</p>

<p>NSFetchRequest *fetchRequest = [[[NSFetchRequest alloc] init] autorelease];</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NSEntityDescription *entity = [NSEntityDescription entityForName:@"ContactInfo" inManagedObjectContext:context];
</code></pre></div></div>

<p>[fetchRequest setEntity:entity];</p>

<p>NSError *error;</p>

<p>NSArray *fetchedObjects = [context executeFetchRequest:fetchRequest error:&amp;error];</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>for (Student *info in fetchedObjects) {

    NSLog( @"name:%@" , info.name);

    NSLog( @"age:%d" , info.age);

    NSLog( @"classID:%@" , classID );
</code></pre></div></div>

<p>School *details = info.details;</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    NSLog( @" persons :%d" , details.persons);

     NSLog( @" classID :%d" , details.classID);
</code></pre></div></div>

<p>}</p>

<p>}</p>

<p>6.~~ æ•°æ®åº“ç›¸å…³
1ï¼‰æ‰“å°éšè—çš„sqlè¯­å¥ï¼š</p>

<p>åœ¨Edit Schemeä¸­é€‰æ‹©Runï¼Œä¹‹åè¿›å…¥Argumentsæ ‡ç­¾ï¼Œæ·»åŠ å‚æ•°ï¼šâ€œ-com.apple.CoreData.SQLDebug 1â€</p>

<p>2ï¼‰ä½¿ç”¨SQLiteå­˜å‚¨æ—¶ï¼Œæ•°æ®åº“ç»“æ„</p>

<p>å­˜å‚¨çš„SQLiteæ•°æ®åº“è¡¨åç§°ï¼šå¤§å†™â€œZâ€åŠ ä¸Šå®ä½“åç§°å¤§å†™ï¼Œä¸€ä¸ªå®ä½“ç›¸å½“äºä¸€å¼ è¡¨</p>

<p>å…·ä½“çš„å­—æ®µåç§°ï¼šå¤§å†™â€œZâ€åŠ ä¸Šå®ä½“å±æ€§åç§°å¤§å†™</p>

<p>äºŒ.SQLite
mac os xä¸­SQLiteåº“ï¼Œå®ƒæ˜¯ä¸€ä¸ªè½»é‡çº§åŠŸèƒ½å¼ºå¤§çš„å…³ç³»æ•°æ®å¼•æ“ï¼Œä¹Ÿå¾ˆå®¹æ˜“åµŒå…¥åˆ°åº”ç”¨ç¨‹åºã€‚å¯ä»¥åœ¨å¤šä¸ªå¹³å°ä½¿ç”¨ï¼ŒSQLiteæ˜¯ä¸€ä¸ªè½»é‡çº§çš„åµŒå…¥å¼sqlæ•°æ®åº“ç¼–ç¨‹ã€‚ä¸core dataæ¡†æ¶ä¸åŒçš„æ˜¯ï¼Œ SQLiteæ˜¯ä½¿ç”¨ç¨‹åºå¼çš„ï¼Œsqlçš„ä¸»è¦çš„APIæ¥ç›´æ¥æ“ä½œæ•°æ®è¡¨ã€‚</p>

<p>SQLite3æ˜¯ä¸€ä¸ªéå¸¸çµæ´»çš„æ•°æ®åº“ç³»ç»Ÿï¼Œæ²¡æœ‰æ•°æ®åº“æœåŠ¡å™¨çš„æ¦‚å¿µï¼Œè¿™åº”è¯¥ç®—æ˜¯å›å½’äº†æ¯”è¾ƒä¼ ç»Ÿçš„æ•°æ®åº“è®¾è®¡ã€‚</p>

<p>æ—©æœŸæˆ‘ä»¬çš„æ•°æ®éƒ½æ˜¯ç›´æ¥å­˜æ”¾åœ¨æ–‡ä»¶ç³»ç»Ÿï¼Œç”±äºç®€å•çš„æ–‡ä»¶ç³»ç»Ÿå­˜åœ¨æ•°æ®å†—ä½™ã€ä¸ä¸€è‡´ã€è¯»å–æ“ä½œç¹çï¼ˆæ¯ä¸ªæ•°æ®ç»“æ„éƒ½å¯èƒ½è¦ç¼–å†™è‡ªå·±çš„è¯»å†™ç¨‹åºï¼‰ç­‰ï¼Œæ…¢æ…¢å½¢æˆäº†æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œä¸€å¥—å®Œæ•´çš„æ•°æ®åº“ç†è®ºã€‚</p>

<p>ç›®å‰è¾ƒä¸ºæµè¡Œçš„Oracle, SqlServer, MySqlç­‰æ•°æ®åº“ç³»ç»Ÿå‡æ˜¯æœåŠ¡å™¨-å®¢æˆ·ç«¯çš„æ¦‚å¿µï¼Œæ•°æ®åº“æœåŠ¡å™¨è´Ÿè´£æ‰€æœ‰çš„æ•°æ®ç®¡ç†ã€æƒé™ç®¡ç†ç­‰ï¼Œå®¢æˆ·ç«¯æŒ‰ç…§ä¸€å®šæ ¼å¼å‘å‡ºè¯·æ±‚å³å¯ã€‚</p>

<p>sqlåˆ™æ˜¯è¾ƒä¸ºæµè¡Œçš„ç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€ï¼Œä¸ºä¼—å¤šä¸Šå±‚åº”ç”¨æä¾›ç®€å•æ–¹ä¾¿çš„æ•°æ®åº“è¯»å†™æ“ä½œç­‰ã€‚</p>

<p>ä½†æ˜¯å¯æƒ³è€ŒçŸ¥ï¼ŒæœåŠ¡å™¨ç«¯å¿…å®šæ˜¯éœ€è¦å¯¹sqlè¯·æ±‚è¿›è¡Œè§£æç„¶åæ‰§è¡Œçš„ï¼Œé‚£ä¹ˆè¿™äº›æ‰§è¡Œç¨‹åºè¿˜å¾—å›å½’æ›´åº•å±‚çš„è¯­è¨€ï¼Œæ¯”å¦‚C&amp;C++çš„å®ç°ã€‚</p>

<p>æ³¨æ„ï¼š</p>

<p>ç¬¬1ä»£è¯­è¨€ æœºå™¨è¯­è¨€ï¼ˆæŒ‡ä»¤ç³»ç»Ÿï¼‰å…¶æŒ‡ä»¤ä¸ºäºŒè¿›åˆ¶ä»£ç (0ã€1)ï¼Œç›´æ¥å¯¹åº”èŠ¯ç‰‡ä¸Šçš„è¿ç®—äº†</p>

<p>ç¬¬2ä»£è¯­è¨€ æ±‡ç¼–è¯­è¨€ ç”¨â€œåŠ©è®°ç¬¦â€ä»£æ›¿äºŒè¿›åˆ¶ä»£ç ï¼Œå¦‚ç”¨ADD A,Bè¡¨ç¤ºä¸¤æ•°ç›¸åŠ ã€‚</p>

<p>ç¬¬3ä»£è¯­è¨€ é«˜çº§è¯­è¨€ï¼ˆé¢å‘è¿‡ç¨‹ï¼‰ä¾‹å¦‚ï¼šCã€JAVAã€C++ã€‚</p>

<p>ç¬¬4ä»£è¯­è¨€ï¼ˆéè¿‡ç¨‹åŒ–è¯­è¨€ï¼‰  ä¾‹å¦‚ï¼šSQLè¯­è¨€ã€‚</p>

<p>ç¬¬5ä»£è¯­è¨€ï¼ˆæ™ºèƒ½åŒ–è¯­è¨€ï¼‰ ä¾‹å¦‚ï¼šPrologè¯­è¨€ï¼‰</p>

<p>è€ŒSQLite3ä»åŠŸèƒ½ä¸Šæ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªæ•°æ®åº“ç³»ç»Ÿï¼Œå…¶æœ¬è´¨ä¸Šæ˜¯ç”±ä¸€å¥—ç”¨Cè¯­è¨€å®ç°çš„å¯¹æ•°æ®åº“æ–‡ä»¶çš„è¯»å†™æ¥å£ã€‚æ­¤ç±»æ¥å£æ”¯æŒsqlè¯­è¨€ã€‚æ‰€ä»¥ï¼Œè¿™ä¸éœ€è¦ä»€ä¹ˆæœåŠ¡å™¨ï¼Œä¹Ÿæ²¡æœ‰æ•°æ®åº“æƒé™ç®¡ç†ã€‚åœ¨ç¨‹åºä¸­å¯ä»¥éšæ—¶è°ƒç”¨APIåˆ›å»ºä¸€ä¸ªæ•°æ®åº“æ–‡ä»¶ï¼Œè¿›è¡Œæ•°æ®å­˜å‚¨ï¼Œéå¸¸çµæ´»æ˜“ç”¨ã€‚</p>

<p>2.1 å»ºç«‹SQLite3.0æ•°æ®åº“
åœ¨Firefoxä¸­æ‰“å¼€SQLite3ï¼ˆå¦‚æœæ²¡æœ‰ï¼Œé€‰æ‹©å·¥å…·-&gt;é™„åŠ ç»„ä»¶ï¼Œæ·»åŠ å³å¯ï¼‰æ–°å»ºSQLite3æ•°æ®åº“,Contacts,</p>

<p>å»ºç«‹ä¸€ä¸ªmembersè¡¨ï¼Œå­—æ®µ id,integer,ä¸»é”®ï¼Œè‡ªå¢;name,varchar;email,varchar,null;birthday,datetime,nullã€‚</p>

<p>å‘è¡¨ä¸­æ·»åŠ ä¸€äº›æ•°æ®ï¼š</p>

<p>pastedGraphic_11.pdf</p>

<p>2.2 SQLiteä½¿ç”¨ä»£ç  
æ–°å»ºEmpty Appliationï¼Œæ·»åŠ ä¸€ä¸ªHomeViewControllerï¼Œå’Œä¸€ä¸ªç»„ä»¶libSQLite3.dylib,æ¥æ”¯æŒå¯¹SQLite3çš„è¿æ¥ï¼Œå…³é—­ï¼Œå¢åˆ æ”¹æŸ¥ç­‰æ“ä½œã€‚</p>

<p>1.ï¼‰HomeViewController.hä»£ç ï¼š</p>

<p>#import</p>

<p>#import â€œSQLite3.hâ€</p>

<p>@interface HomeViewController : UIViewController{</p>

<p>SQLite3 *db; //å£°æ˜ä¸€ä¸ªSQLite3æ•°æ®åº“</p>

<p>}</p>

<ul>
  <li>(NSString *)filePath;//æ•°æ®åº“æ–‡ä»¶çš„è·¯å¾„ã€‚ä¸€èˆ¬åœ¨æ²™ç®±çš„Documentsé‡Œè¾¹æ“ä½œ</li>
</ul>

<p>@end</p>

<p>2.ï¼‰HomeViewController.mä»£ç ï¼š</p>

<p>#import â€œHomeViewController.hâ€</p>

<p>@interface HomeViewController ()</p>

<p>@end</p>

<p>@implementation HomeViewController</p>

<p>//è¯¥æ–¹æ³•ç”¨äºè¿”å›æ•°æ®åº“åœ¨Documentsæ–‡ä»¶å¤¹ä¸­çš„å…¨è·¯å¾„ä¿¡æ¯</p>

<ul>
  <li>(NSString *)filePath{</li>
</ul>

<p>NSArray *paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);</p>

<p>NSString *documentsDir = [paths objectAtIndex:0];</p>

<p>return [documentsDir stringByAppendingPathComponent:@â€Contacts.SQLiteâ€];</p>

<p>}</p>

<p>//æ‰“å¼€æ•°æ®åº“çš„æ–¹æ³•</p>

<ul>
  <li>(void)openDB{</li>
</ul>

<p>if (SQLite3_open([[self filePath] UTF8String], &amp;db) != SQLite_OK) {</p>

<p>SQLite3_close(db);</p>

<p>NSAssert(0, @â€æ•°æ®åº“æ‰“å¼€å¤±è´¥ã€‚â€);</p>

<p>}</p>

<p>}</p>

<p>//æ’å…¥æ•°æ®æ–¹æ³•</p>

<ul>
  <li>(void)insertRecordIntoTableName:(NSString *)tableName</li>
</ul>

<p>withField1:(NSString *)field1 field1Value:(NSString *)field1Value</p>

<p>andField2:(NSString *)field2 field2Value:(NSString *)field2Value</p>

<p>andField3:(NSString *)field3 field3Value:(NSString *)field3Value{</p>

<p>//æ–¹æ³•2ï¼šå˜é‡çš„ç»‘å®šæ–¹æ³•</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NSString *sql = [NSString stringWithFormat:@"INSERT INTO '%@' ('%@', '%@', '%@') VALUES (?, ?, ?)",tableName, field1, field2, field3];
</code></pre></div></div>

<p>SQLite3_stmt *statement;</p>

<p>if (SQLite3_prepare_v2(db, [sql UTF8String], -1, &amp;statement, nil) == SQLite_OK) {</p>

<p>SQLite3_bind_text(statement, 1, [field1Value UTF8String], -1,NULL);</p>

<p>SQLite3_bind_text(statement, 2, [field2Value UTF8String], -1,NULL);</p>

<p>SQLite3_bind_text(statement, 3, [field3Value UTF8String], -1,NULL);</p>

<p>}</p>

<p>if (SQLite3_step(statement) != SQLite_DONE) {</p>

<p>NSAssert(0, @â€æ’å…¥æ•°æ®å¤±è´¥ï¼â€);</p>

<p>SQLite3_finalize(statement);</p>

<p>}</p>

<p>}</p>

<p>//æŸ¥è¯¢æ•°æ®</p>

<ul>
  <li>(void)getAllContacts{</li>
</ul>

<p>NSString *sql = @â€SELECT * FROM membersâ€;</p>

<p>SQLite3_stmt *statement;</p>

<p>if (SQLite3_prepare_v2(db, [sql UTF8String], -1, &amp;statement, nil) == SQLite_OK) {</p>

<p>while (SQLite3_step(statement) == SQLite_ROW) {</p>

<p>char *name = (char *)SQLite3_column_text(statement, 0);</p>

<p>NSString *nameStr = [[NSString alloc] initWithUTF8String:name];</p>

<p>char *email = (char *)SQLite3_column_text(statement, 1);</p>

<p>NSString *emailStr = [[NSString alloc] initWithUTF8String:email];</p>

<p>char *birthday = (char *)SQLite3_column_text(statement, 2);</p>

<p>NSString *birthdayStr = [[NSString alloc] initWithUTF8String:birthday];</p>

<p>NSString *info = [[NSString alloc] initWithFormat:@â€%@ - %@ - %@â€,</p>

<p>nameStr, emailStr, birthdayStr];</p>

<p>NSLog(info);</p>

<p>[nameStr release];</p>

<p>[emailStr release];</p>

<p>[birthdayStr release];</p>

<p>[info release];</p>

<p>}</p>

<p>SQLite3_finalize(statement);</p>

<p>}</p>

<p>}</p>

<ul>
  <li>(void)viewDidLoad</li>
</ul>

<p>{</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[self openDB];

[self insertRecordIntoTableName:@"members" withField1:@"name" field1Value:@"æ1" andField2:@"email" field2Value:@" df@qq.com " andField3:@"birthday" field3Value:@"12-45-78"];

[self insertRecordIntoTableName:@"members" withField1:@"name" field1Value:@"æ2" andField2:@"email" field2Value:@" df@qq.com " andField3:@"birthday" field3Value:@"12-45-78"];

[self insertRecordIntoTableName:@"members" withField1:@"name" field1Value:@"æ3" andField2:@"email" field2Value:@" df@qq.com " andField3:@"birthday" field3Value:@"12-45-78"];

[self getAllContacts];
</code></pre></div></div>

<p>SQLite3_close(db);</p>

<p>[super viewDidLoad];</p>

<p>}</p>

<p>@end</p>

<p>æ’å…¥æ•°æ®åçš„æ•ˆæœï¼š</p>

<p>pastedGraphic_12.pdf</p>

<p>æŸ¥è¯¢çš„æ•ˆæœï¼š</p>

<p>pastedGraphic_13.pdf</p>

<p>2.3 å°ç»“ï¼š
æ•°æ®æŸ¥è¯¢ï¼šSQLite3_exec()å‡½æ•°æ‰§è¡Œsqlè¯­å¥ï¼Œåœ¨æ²¡æœ‰è¿”å›å€¼çš„æƒ…å†µä¸‹ï¼ˆæ¯”å¦‚åˆ›å»ºè¡¨æ ¼ã€æ’å…¥è®°å½•ã€åˆ é™¤è®°å½•ç­‰æ“ä½œä¸­ï¼‰å¾ˆå¥½ç”¨ã€‚</p>

<p>ä¹Ÿä¼šç”¨åˆ°SQLite3_statç»“æ„ã€SQLite3_prepare_v2()å‡½æ•°ã€sqlte3_step()å‡½æ•°å’ŒSQLite3_finalize()å‡½æ•°ã€‚</p>

<p>æŸ¥è¯¢åˆ†ä¸‰ä¸ªé˜¶æ®µï¼šå‡†å¤‡é˜¶æ®µï¼šSQLite3_statã€SQLite3_prepare_v2()</p>

<p>æ‰§è¡Œé˜¶æ®µï¼šsqlte3_step()</p>

<p>ç»ˆæ­¢é˜¶æ®µï¼š SQLite3_finalize()</p>

<p>ä¸‰.FMDB
FMDBæ¡†æ¶å…¶å®åªæ˜¯ä¸€å±‚å¾ˆè–„çš„å°è£…ï¼Œä¸»è¦çš„ç±»ä¹Ÿå°±ä¸¤ä¸ªï¼šFMDatabaseå’ŒFMResultSetã€‚åœ¨ä½¿ç”¨FMDBçš„æ—¶å€™è¿˜éœ€è¦å¯¼å…¥libSQLite3.0.dylibã€‚</p>

<p>iOSä¸­åŸç”Ÿçš„SQLite APIåœ¨ä½¿ç”¨ä¸Šç›¸å½“ä¸å‹å¥½ï¼Œåœ¨ä½¿ç”¨æ—¶ï¼Œéå¸¸ä¸ä¾¿ã€‚äºæ˜¯ï¼Œå°±å‡ºç°äº†ä¸€ç³»åˆ—å°†SQLite APIè¿›è¡Œå°è£…çš„åº“ï¼Œä¾‹å¦‚FMDBã€ PlausibleDatabaseã€SQLitepersistentobjectsç­‰ï¼Œ FMDB ( https://github.com/ccgus/ FMDB) æ˜¯ä¸€æ¬¾ç®€æ´ã€æ˜“ç”¨çš„å°è£…åº“ï¼Œè¿™ä¸€ç¯‡æ–‡ç« ç®€å•ä»‹ç»ä¸‹FMDBçš„ä½¿ç”¨ã€‚</p>

<p>åœ¨FMDBä¸‹è½½æ–‡ä»¶åï¼Œå·¥ç¨‹ä¸­å¿…é¡»å¯¼å…¥å¦‚ä¸‹æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ libSQLite3.dylib ä¾èµ–åŒ…ã€‚</p>

<p>pastedGraphic_14.pdf</p>

<p>FMDBåŒæ—¶å…¼å®¹ARCå’ŒéARCå·¥ç¨‹ï¼Œä¼šè‡ªåŠ¨æ ¹æ®å·¥ç¨‹é…ç½®æ¥è°ƒæ•´ç›¸å…³çš„å†…å­˜ç®¡ç†ä»£ç ã€‚</p>

<p>FMDBå¸¸ç”¨ç±»ï¼š</p>

<p>FMDatabase ï¼š ä¸€ä¸ªå•ä¸€çš„SQLiteæ•°æ®åº“ï¼Œç”¨äºæ‰§è¡ŒSQLè¯­å¥ã€‚</p>

<p>FMResultSet ï¼šæ‰§è¡ŒæŸ¥è¯¢ä¸€ä¸ªFMDatabaseç»“æœé›†ï¼Œè¿™ä¸ªå’Œandroidçš„Cursorç±»ä¼¼ã€‚</p>

<p>FMDatabaseQueue ï¼šåœ¨å¤šä¸ªçº¿ç¨‹æ¥æ‰§è¡ŒæŸ¥è¯¢å’Œæ›´æ–°æ—¶ä¼šä½¿ç”¨è¿™ä¸ªç±»ã€‚</p>

<p>3.1 æ•°æ®åŸºæœ¬æ“ä½œ
1ï¼‰ åˆ›å»ºæ•°æ®åº“ï¼š</p>

<p>db= [FMDatabase databaseWithPath:database_path];</p>

<p>1ã€å½“æ•°æ®åº“æ–‡ä»¶ä¸å­˜åœ¨æ—¶ï¼ŒFMDBä¼šè‡ªå·±åˆ›å»ºä¸€ä¸ªã€‚</p>

<p>2ã€ å¦‚æœä½ ä¼ å…¥çš„å‚æ•°æ˜¯ç©ºä¸²ï¼š@â€â€ ï¼Œåˆ™FMDBä¼šåœ¨ä¸´æ—¶æ–‡ä»¶ç›®å½•ä¸‹åˆ›å»ºè¿™ä¸ªæ•°æ®åº“ï¼Œæ•°æ®åº“æ–­å¼€è¿æ¥æ—¶ï¼Œæ•°æ®åº“æ–‡ä»¶è¢«åˆ é™¤ã€‚</p>

<p>3ã€å¦‚æœä½ ä¼ å…¥çš„å‚æ•°æ˜¯ NULLï¼Œåˆ™å®ƒä¼šå»ºç«‹ä¸€ä¸ªåœ¨å†…å­˜ä¸­çš„æ•°æ®åº“ï¼Œæ•°æ®åº“æ–­å¼€è¿æ¥æ—¶ï¼Œæ•°æ®åº“æ–‡ä»¶è¢«åˆ é™¤ã€‚</p>

<p>2ï¼‰ æ‰“å¼€æ•°æ®åº“ï¼š</p>

<p>è¿”å›BOOLå‹ã€‚</p>

<p>3ï¼‰ å…³é—­æ•°æ®åº“ï¼š</p>

<p>[dbclose]</p>

<p>3.2 æ•°æ®åº“å¢åˆ æ”¹ç­‰æ“ä½œï¼š
é™¤äº†æŸ¥è¯¢æ“ä½œï¼ŒFMDBæ•°æ®åº“æ“ä½œéƒ½æ‰§è¡ŒexecuteUpdateæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›BOOLå‹ã€‚</p>

<p>çœ‹ä¸€ä¸‹ä¾‹å­ï¼š</p>

<p>1ï¼‰åˆ›å»ºè¡¨ï¼š</p>

<p>if ([db open]) {</p>

<p>NSString *sqlCreateTable = [NSString stringWithFormat:@â€CREATE TABLE IF NOT EXISTS â€˜%@â€™ (â€˜%@â€™ INTEGER PRIMARY KEY AUTOINCREMENT, â€˜%@â€™ TEXT, â€˜%@â€™ INTEGER, â€˜%@â€™ TEXT)â€,TABLENAME,ID,NAME,AGE,ADDRESS];</p>

<p>BOOL res = [db executeUpdate:sqlCreateTable];</p>

<p>if (!res) {</p>

<p>NSLog(@ â€œerror when creating db tableâ€ );</p>

<p>}  else {</p>

<p>NSLog(@ â€œsuccess to creating db tableâ€ );</p>

<p>}</p>

<p>[db close];</p>

<p>}</p>

<p>2ï¼‰æ·»åŠ æ•°æ®ï¼š</p>

<p>if ([db open]) {</p>

<p>NSString *insertSql1= [NSString stringWithFormat:</p>

<p>@â€INSERT INTO â€˜%@â€™ (â€˜%@â€™, â€˜%@â€™, â€˜%@â€™) VALUES (â€˜%@â€™, â€˜%@â€™, â€˜%@â€™)â€, TABLENAME, NAME, AGE, ADDRESS, @ â€œå¼ ä¸‰â€ , @ â€œ13â€ , @ â€œæµå—â€ ];</p>

<p>BOOL res = [db executeUpdate:insertSql1];</p>

<p>NSString *insertSql2 = [NSString stringWithFormat:</p>

<p>@â€INSERT INTO â€˜%@â€™ (â€˜%@â€™, â€˜%@â€™, â€˜%@â€™) VALUES (â€˜%@â€™, â€˜%@â€™, â€˜%@â€™)â€,TABLENAME, NAME, AGE, ADDRESS, @ â€œæå››â€ , @ â€œ12â€ , @ â€œæµå—â€ ];</p>

<p>BOOL res2 = [db executeUpdate:insertSql2];</p>

<p>if (!res) {</p>

<p>NSLog(@â€error when insert db tableâ€);</p>

<p>}  else {</p>

<p>NSLog(@â€success to insert db tableâ€);</p>

<p>}</p>

<p>[db close];</p>

<p>}</p>

<p>3ï¼‰ä¿®æ”¹æ•°æ®ï¼š</p>

<p>if ([db open]) {</p>

<p>NSString *updateSql = [NSString stringWithFormat:</p>

<p>@â€UPDATE â€˜%@â€™ SET â€˜%@â€™ = â€˜%@â€™ WHERE â€˜%@â€™ = â€˜%@â€™â€œ,TABLENAME, AGE, @â€15â€ ,AGE, @ â€œ13â€ ];</p>

<p>BOOL res = [db executeUpdate:updateSql];</p>

<p>if (!res) {</p>

<p>NSLog(@â€error when update db tableâ€);</p>

<p>}  else {</p>

<p>NSLog(@â€success to update db tableâ€);</p>

<p>}</p>

<p>[db close];</p>

<p>}</p>

<p>4ï¼‰åˆ é™¤æ•°æ®ï¼š</p>

<p>if ([db open]) {</p>

<p>NSString *deleteSql = [NSString stringWithFormat:</p>

<p>@ â€œdelete from %@ where %@ = â€˜%@â€™â€ ,</p>

<p>TABLENAME, NAME, @ â€œå¼ ä¸‰â€ ];</p>

<p>BOOL res = [db executeUpdate:deleteSql];</p>

<p>if (!res) {</p>

<p>NSLog(@â€error when delete db tableâ€);</p>

<p>}  else {</p>

<p>NSLog(@â€success to delete db tableâ€);</p>

<p>}</p>

<p>[db close];</p>

<p>}</p>

<p>5ï¼‰æ•°æ®åº“æŸ¥è¯¢æ“ä½œï¼š</p>

<p>æŸ¥è¯¢æ“ä½œä½¿ç”¨äº†executeQueryï¼Œå¹¶æ¶‰åŠåˆ° FMResultSetã€‚</p>

<p>if ([db open]) {</p>

<p>NSString * sql = [NSString stringWithFormat:</p>

<p>@ â€œSELECT * FROM %@â€ ,TABLENAME];</p>

<p>FMResultSet * rs = [db executeQuery:sql];</p>

<p>while ([rs next]) {</p>

<p>int Id = [rs intForColumn:ID];</p>

<p>NSString * name = [rs stringForColumn:NAME];</p>

<p>NSString * age = [rs stringForColumn:AGE];</p>

<p>NSString * address = [rs stringForColumn:ADDRESS];</p>

<p>NSLog(@â€id = %d, name = %@, age = %@ address = %@â€, Id, name, age, address);</p>

<p>}</p>

<p>[db close];</p>

<p>}</p>

<p>FMDBçš„FMResultSetæä¾›äº†å¤šä¸ªæ–¹æ³•æ¥è·å–ä¸åŒç±»å‹çš„æ•°æ®ï¼š</p>

<p>3.3 æ•°æ®åº“å¤šçº¿ç¨‹æ“ä½œï¼š
å¦‚æœåº”ç”¨ä¸­ä½¿ç”¨äº†å¤šçº¿ç¨‹æ“ä½œæ•°æ®åº“ï¼Œé‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨FMDatabaseQueueæ¥ä¿è¯çº¿ç¨‹å®‰å…¨äº†ã€‚ åº”ç”¨ä¸­ä¸å¯åœ¨å¤šä¸ªçº¿ç¨‹ä¸­å…±åŒä½¿ç”¨ä¸€ä¸ªFMDatabaseå¯¹è±¡æ“ä½œæ•°æ®åº“ï¼Œè¿™æ ·ä¼šå¼•èµ·æ•°æ®åº“æ•°æ®æ··ä¹±ã€‚ ä¸ºäº†å¤šçº¿ç¨‹æ“ä½œæ•°æ®åº“å®‰å…¨ï¼ŒFMDBä½¿ç”¨äº†FMDatabaseQueueï¼Œä½¿ç”¨FMDatabaseQueueå¾ˆç®€å•ï¼Œé¦–å…ˆç”¨ä¸€ä¸ªæ•°æ®åº“æ–‡ä»¶åœ°å€æ¥åˆä½¿åŒ–FMDatabaseQueueï¼Œç„¶åå°±å¯ä»¥å°†ä¸€ä¸ªé—­åŒ…(block)ä¼ å…¥inDatabaseæ–¹æ³•ä¸­ã€‚ åœ¨é—­åŒ…ä¸­æ“ä½œæ•°æ®åº“ï¼Œè€Œä¸ç›´æ¥å‚ä¸FMDatabaseçš„ç®¡ç†ã€‚</p>

<p>FMDatabaseQueue* queue = [FMDatabaseQueue databaseQueueWithPath:database_path];</p>

<p>dispatch_queue_t q1 = dispatch_queue_create( â€œqueue1â€ , NULL);</p>

<p>dispatch_queue_t q2 = dispatch_queue_create( â€œqueue2â€ , NULL);</p>

<p>dispatch_async(q1, ^{</p>

<p>for ( int i = 0; i &lt; 50; ++i) {</p>

<p>[queue inDatabase:^(FMDatabase *db2) {</p>

<p>NSString *insertSql1= [NSString stringWithFormat:</p>

<p>@ â€œINSERT INTO â€˜%@â€™ (â€˜%@â€™, â€˜%@â€™, â€˜%@â€™) VALUES (?, ?, ?)â€ ,</p>

<p>TABLENAME, NAME, AGE, ADDRESS];</p>

<p>NSString * name = [NSString stringWithFormat:@ â€œjack %dâ€ , i];</p>

<p>NSString * age = [NSString stringWithFormat:@ â€œ%dâ€ , 10+i];</p>

<p>BOOL res = [db2 executeUpdate:insertSql1, name, age,@ â€œæµå—â€ ];</p>

<p>if (!res) {</p>

<p>NSLog(@ â€œerror to inster data: %@â€ , name);</p>

<p>}  else {</p>

<p>NSLog(@ â€œsucc to inster data: %@â€ , name);</p>

<p>}</p>

<p>}];</p>

<p>}</p>

<p>});</p>

<p>dispatch_async(q2, ^{</p>

<p>for ( int i = 0; i &lt; 50; ++i) {</p>

<p>[queue inDatabase:^(FMDatabase *db2) {</p>

<p>NSString *insertSql2= [NSString stringWithFormat:</p>

<p>@ â€œINSERT INTO â€˜%@â€™ (â€˜%@â€™, â€˜%@â€™, â€˜%@â€™) VALUES (?, ?, ?)â€ ,</p>

<p>TABLENAME, NAME, AGE, ADDRESS];</p>

<p>NSString * name = [NSString stringWithFormat:@ â€œlilei %dâ€ , i];</p>

<p>NSString * age = [NSString stringWithFormat:@ â€œ%dâ€ , 10+i];</p>

<p>BOOL res = [db2 executeUpdate:insertSql2, name, age,@ â€œåŒ—äº¬â€ ];</p>

<p>if (!res) {</p>

<p>NSLog(@ â€œerror to inster data: %@â€ , name);</p>

<p>}  else {</p>

<p>NSLog(@ â€œsucc to inster data: %@â€ , name);</p>

<p>}</p>

<p>}];</p>

<p>}</p>

<p>});</p>

<p>4.æ€»ç»“
CoreDataå…è®¸ç”¨æˆ·ä½¿ç”¨ä»£è¡¨å®ä½“å’Œå®ä½“é—´å…³ç³»çš„é«˜å±‚å¯¹è±¡æ¥æ“ä½œæ•°æ®ã€‚å®ƒä¹Ÿå¯ä»¥ç®¡ç†ä¸²è¡ŒåŒ–çš„æ•°æ®ï¼Œæä¾›å¯¹è±¡ç”Ÿå­˜æœŸç®¡ç†ä¸object_graph ç®¡ç†ï¼ŒåŒ…æ‹¬å­˜å‚¨ã€‚Core Dataç›´æ¥ä¸ SQLite äº¤äº’ï¼Œé¿å…å¼€å‘è€…ä½¿ç”¨åŸæœ¬çš„ SQL è¯­å¥.
ä¸Šé¢çš„ä¸‰ç§ï¼Œéƒ½æ˜¯åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨å‘¢ï¼Ÿå¤§å¤šæ•°äººè‚¯å®šæ˜¯æ ¹æ®è‡ªå·±ä½¿ç”¨æŸé¡¹æŠ€æœ¯çš„æ—¶é—´ä¹Ÿå°±æ˜¯æŒæ¡çš„ç†Ÿç»ƒç¨‹åº¦æ¥å†³å®šï¼Œä¾‹å¦‚ä»¥å‰æ²¡ç”¨è¿‡CoreDataï¼Œåœ¨ç¼–å†™iosç¨‹åºçš„æ—¶å€™è¿˜æ˜¯ä½¿ç”¨è‡ªå·±æ¯”è¾ƒæ‹¿æ‰‹çš„SQLiteï¼Œæˆ–è€…å¯èƒ½ä¼šè€ƒè™‘åˆ°åœ¨ä½¿ç”¨coredataè‡ªå·±è¿˜è¦èŠ±è´¹é¢å¤–çš„æ—¶å€™å»å­¦ä¹ ã€‚
ä½†æ˜¯ä»”ç»†æƒ³ä¸€æƒ³ï¼ŒCoreDataæ˜¯è‹¹æœè‡ªå·±å¼„çš„æ¡†æ¶ï¼Œå®ƒå…¶å®è¿˜æ˜¯å’ŒSQLiteè¿›è¡Œäº¤äº’çš„ï¼Œåªæ˜¯åœ¨äº¤äº’çš„æ—¶å€™æˆ–è€…å¤„ç†æ•°æ®çš„æ—¶å€™è¿›è¡Œäº†å¾ˆå¤šçš„ä¼˜åŒ–ï¼ŒCoreDataå¯ä»¥ç¼©å°ä½ çš„ä»£ç é‡ï¼Œè€Œä¸”CoreDataå·²ç»ä¼˜åŒ–è¿‡å¾ˆå¤šä¸ªç‰ˆæœ¬ï¼Œè¿˜æä¾›äº†å‡ºè‰²çš„å®‰å…¨æ€§å’Œé”™è¯¯å¤„ç†ä¹‹å¤–ï¼Œè¿˜æä¾›äº†å¯¹ä»»ä½•ç«äº‰æ€§æ–¹æ¡ˆçš„æœ€å¥½çš„å†…å­˜å¯æ‰©å±•æ€§ã€‚æ¢å¥è¯è¯´å°±æ˜¯ï¼Œä½ å¯èƒ½èŠ±è´¹äº†å¾ˆé•¿æ—¶é—´ä¸ºæŸä¸ªé—®é¢˜è¿›è¡Œä¼˜åŒ–ç²¾å¿ƒåˆ¶ä½œäº†ä¸€ä¸ªæ–¹æ¡ˆï¼Œä½†æ˜¯åœ¨æ€§èƒ½ä¸Šçš„ä¼˜åŠ¿å’ŒCoreDataç›¸æ¯”ï¼Œè¿˜æ˜¯ç›¸å·®æ·±è¿œçš„ã€‚
å¦å¤–å°±æ˜¯CoreDataä¸Mac OS Xçš„é›†æˆéå¸¸çš„å¥½ï¼ŒCoreDataä¹Ÿå’ŒIBè¿›è¡Œäº†ç»“åˆï¼Œå…è®¸ä½ åˆ›å»ºç”¨æˆ·ç•Œé¢ï¼Œè¿™æ ·å¯ä»¥å¸®åŠ©ä½ ç¼©çŸ­åº”ç”¨ç¨‹åºçš„è®¾è®¡ï¼Œå®æ–½ä»¥åŠè°ƒè¯•å‘¨æœŸã€‚
æ‰€ä»¥åœ¨ç¼–å†™ç¨‹åºçš„æ—¶å€™å°½é‡ä½¿ç”¨CoreDataï¼Œè¿™æ ·æ‰æ˜¯æœ€ä¼˜çš„é€‰æ‹©ã€‚åªæœ‰åœ¨Core Data is available on iOS 3.0 and lateræ‰èƒ½ä½¿ç”¨CoreDataã€‚
è‡³äºSQLiteå’ŒFMDBçš„ä½¿ç”¨æƒ…å†µï¼Œè¿™ä¸ªçœ‹ä¸ªäººå–œå¥½äº†ï¼Œä¸ªäººè§‰å¾—æ²¡ä»€ä¹ˆæ ‡å‡†ã€‚FMDBå°±æ˜¯å¯¹SQLiteçš„å°è£…ï¼Œä½¿ç”¨èµ·æ¥æœ‰æ–¹ä¾¿çš„æ¥å£ï¼Œæ²¡é‚£ä¹ˆéº»çƒ¦è€Œå·²ã€‚</p>
:ET