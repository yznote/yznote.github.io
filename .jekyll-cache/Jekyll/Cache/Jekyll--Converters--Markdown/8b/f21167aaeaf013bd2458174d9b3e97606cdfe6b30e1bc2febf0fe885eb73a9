I"¦'<p>####å‡†å¤‡å·¥ä½œ</p>

<p>å®‰è£…<code class="highlighter-rouge">homebrew, git, yasm.</code>(å¦‚æœå·²ç»å®‰è£…å¥½å¯ä»¥è·³è¿‡, ä¸æ¸…æ¥šçš„å†æ¥ä¸€éä¹Ÿæ— å¦¨,ä¸€èˆ¬macéƒ½å·²ç»å®‰è£…)</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
brew install git
brew install yasm
</code></pre></div></div>

<p>ps:æŠ¥é”™â€“&gt;(Warning: /usr/local/bin is not in your PATH.)</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ç»ˆç«¯è¾“å…¥å‘½ä»¤: export PATH=/usr/local/bin:$PATH
</code></pre></div></div>

<h4 id="è·å–-ijkplayer-æºç ">è·å– ijkplayer æºç </h4>

<p>åœ¨ä¸€ä¸ªåˆé€‚çš„ä½ç½®æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹, å‡è®¾ä¸ºæ¡Œé¢, æ–‡ä»¶å¤¹åä¸º<code class="highlighter-rouge">ijkplayer</code>.</p>

<p>æ‰“å¼€ç»ˆç«¯, è¾“å…¥ä¸‹é¢çš„æŒ‡ä»¤</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># è¿›å…¥åˆ°åˆšåˆšæ–°å»ºçš„æ–‡ä»¶å¤¹å†…
cd ~/Desktop/ijkplayer/

# è·å–ijkplayeræºç 
git clone https://github.com/Bilibili/ijkplayer.git ijkplayer-ios

# è¿›å…¥æºç ç›®å½•
cd ijkplayer-ios

# åˆ‡æ¢åˆ†æ”¯ (ç›®å‰ä¸ºk0.8.8, å¯ä»¥è‡ªè¡Œå»GitHubæŸ¥çœ‹æœ€æ–°ç‰ˆæœ¬å·)
git checkout -B latest k0.8.8

</code></pre></div></div>

<h4 id="é…ç½®ç¼–è§£ç å™¨æ ¼å¼æ”¯æŒ">é…ç½®ç¼–è§£ç å™¨æ ¼å¼æ”¯æŒ</h4>

<p>é»˜è®¤ä¸ºæœ€å°‘æ”¯æŒ, å¦‚æœè¶³å¤Ÿä½ ä½¿ç”¨, å¯ä»¥è·³è¿‡è¿™ä¸€æ­¥. å¦åˆ™å¯ä»¥æ”¹ä¸ºä»¥ä¸‹é…ç½®:</p>

<blockquote>
  <p><code class="highlighter-rouge">module-default.sh</code> æ›´å¤šçš„ç¼–è§£ç å™¨/æ ¼å¼<br />
<code class="highlighter-rouge">module-lite-hevc.sh</code> è¾ƒå°‘çš„ç¼–è§£ç å™¨/æ ¼å¼(åŒ…æ‹¬hevc)<br />
<code class="highlighter-rouge">module-lite.sh</code>è¾ƒå°‘çš„ç¼–è§£ç å™¨/æ ¼å¼(é»˜è®¤æƒ…å†µ)</p>
</blockquote>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># è¿›å…¥ config ç›®å½•
cd config

# åˆ é™¤å½“å‰çš„ module.sh æ–‡ä»¶
rm module.sh

# å¯æ ¹æ®éœ€è¦æ›¿æ¢ä¸º`module-default.sh`, `module-lite-hevc.sh`, `module-lite.sh`
# åˆ›å»ºè½¯é“¾æ¥ module.sh æŒ‡å‘ module-lite-hevc.sh
ln -s module-lite-hevc.sh module.sh

cd ..
cd ios
sh compile-ffmpeg.sh clean
</code></pre></div></div>

<h4 id="è·å–-ffmpeg-å¹¶åˆå§‹åŒ–">è·å– ffmpeg å¹¶åˆå§‹åŒ–</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd ..
./init-ios.sh
</code></pre></div></div>

<h4 id="æ·»åŠ -https-æ”¯æŒ">æ·»åŠ  https æ”¯æŒ</h4>

<p>æœ€åä¼šç”Ÿæˆæ”¯æŒ<code class="highlighter-rouge">https</code>çš„é™æ€æ–‡ä»¶<code class="highlighter-rouge">libcrypto.a</code>å’Œ<code class="highlighter-rouge">libssl.a</code>,å¦‚æœä¸éœ€è¦å¯ä»¥è·³è¿‡è¿™ä¸€æ­¥</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># è·å– openssl å¹¶åˆå§‹åŒ–
./init-ios-openssl.sh

cd ios

# åœ¨æ¨¡å—æ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œé…ç½® ä»¥å¯ç”¨ openssl ç»„ä»¶
echo 'export COMMON_FF_CFG_FLAGS="$COMMON_FF_CFG_FLAGS --enable-openssl"' &gt;&gt; ../config/module.sh

./compile-ffmpeg.sh clean
</code></pre></div></div>

<h4 id="ç¼–è¯‘">ç¼–è¯‘</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># å¦‚æœä¸‹ä¸€æ­¥æç¤ºé”™è¯¯`xcrun: error: SDK "iphoneos" cannot be located`, è¯·æ‰§è¡Œ`sudo xcode-select --switch /Applications/Xcode.app/Contents/Developer/`, å†é‡æ–°æ‰§è¡Œä¸‹ä¸€æ­¥

# ç¼–è¯‘openssl, å¦‚æœä¸éœ€è¦httpså¯ä»¥è·³è¿‡è¿™ä¸€æ­¥
./compile-openssl.sh all

# ç¼–è¯‘ffmpeg
./compile-ffmpeg.sh all
</code></pre></div></div>

<p>ps: å¦‚æœæç¤ºé”™è¯¯:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./libavutil/arm/asm.S:50:9: error: unknown directive
        .arch armv7-a
        ^
make: *** [libavcodec/arm/aacpsdsp_neon.o] Error 1
</code></pre></div></div>

<p>æœ€æ–°çš„<code class="highlighter-rouge">Xcode</code>å·²ç»å¼±åŒ–äº†å¯¹ 32 ä½çš„æ”¯æŒ, è§£å†³æ–¹æ³•:<br />
åœ¨<code class="highlighter-rouge">compile-ffmpeg.sh</code>æ–‡ä»¶ä¸­åˆ é™¤<code class="highlighter-rouge">armv7</code>, ä¿®æ”¹å¦‚:<code class="highlighter-rouge">FF_ALL_ARCHS_IOS8_SDK="arm64 i386 x86_64"</code>
å†é‡æ–°æ‰§è¡Œå‡ºç°é”™è¯¯çš„å‘½ä»¤:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ./compile-ffmpeg.sh all
</code></pre></div></div>

<h4 id="æ‰“å¼€-ijkmediaplayer-é¡¹ç›®">æ‰“å¼€ IJKMediaPlayer é¡¹ç›®</h4>

<p>ç”¨å‘½ä»¤:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>open IJKMediaPlayer/IJKMediaPlayer.xcodeproj
</code></pre></div></div>

<p>æˆ–è€…æ‰‹åŠ¨ç”¨ Xcode æ‰“å¼€ ios ç›®å½•ä¸‹çš„ IJKMediaPlayer é¡¹ç›®.</p>

<h4 id="æ·»åŠ -openssl-ç›¸å…³åŒ…ä»¥æ”¯æŒ-https">æ·»åŠ  openssl ç›¸å…³åŒ…ä»¥æ”¯æŒ https</h4>

<p>å¦‚æœä¸ä½¿ç”¨<code class="highlighter-rouge">https</code>, å¯ä»¥è·³è¿‡æ­¤æ­¥, ç›´æ¥å¼€å§‹æ‰“åŒ…<code class="highlighter-rouge">framwork</code>
å¦‚æœä½¿ç”¨<code class="highlighter-rouge">https</code>, é‚£ä¹ˆéœ€è¦æ‰‹åŠ¨ç»™<code class="highlighter-rouge">IJKMediaFramework</code>æ·»åŠ <code class="highlighter-rouge">libcrypto.a</code>å’Œ<code class="highlighter-rouge">libssl.a</code>æ–‡ä»¶, é»˜è®¤ä¸ä¼šæ·»åŠ </p>

<p>ps: è¿™ä¸¤ä¸ªä¾èµ–åº“çš„ç›®å½•ä¸º:<code class="highlighter-rouge">ijkplayer-ios/ios/build/universal/lib</code>, åªæœ‰è¿›è¡Œäº†ä¸Šé¢è·Ÿ<code class="highlighter-rouge">openssl</code>ç›¸å…³çš„æ“ä½œ, æ‰ä¼šåœ¨è¿™ä¸ªç›®å½•ä¸‹æœ‰ç”Ÿæˆ<code class="highlighter-rouge">libcrypto.a</code>å’Œ<code class="highlighter-rouge">libssl.a</code></p>

<p><img src="/img/20200506/1.webp" alt="é¡¹ç›®1" /></p>

<h4 id="æ‰“åŒ…-framwork">æ‰“åŒ… framwork</h4>

<p>å¤§å®¶ä¼šå‘ç°é™¤äº†<code class="highlighter-rouge">IJKMediaFramework</code>è¿™ä¸ª<code class="highlighter-rouge">target</code>, è¿˜æœ‰ä¸€ä¸ªå«<code class="highlighter-rouge">IJKMediaFrameworkWithSSL</code>, ä½†æ˜¯ä¸æ¨èä½¿ç”¨è¿™ä¸ª, å› ä¸ºå¤§éƒ¨åˆ†åŸºäº<code class="highlighter-rouge">ijkplayer</code>çš„ç¬¬ä¸‰æ–¹æ¡†æ¶éƒ½æ˜¯ä½¿ç”¨çš„å‰è€…, ä½ æŠŠåè€…å¯¼å…¥é¡¹ç›®è¿˜æ˜¯ä¼šæŠ¥æ‰¾ä¸åˆ°åŒ…çš„é”™è¯¯, å°±ç®—ä½ è¦æ”¯æŒ<code class="highlighter-rouge">https</code>ä¹Ÿæ¨èä½¿ç”¨å‰è€…, ç„¶åæŒ‰ç…§ä¸Šä¸€æ­¥æ·»åŠ <code class="highlighter-rouge">openssl</code>å³å¯æ”¯æŒ</p>

<p>1.é…ç½®<code class="highlighter-rouge">Release</code>æ¨¡å¼å¦‚æœä¸‹å›¾</p>

<p><img src="/img/20200506/2.webp" alt="é¡¹ç›®2" />
<img src="/img/20200506/3.webp" alt="é¡¹ç›®3" /></p>

<p>2.æ‰“åŒ…çœŸæœº<code class="highlighter-rouge">framework</code>
é€‰æ‹©ä½ è¿æ¥çš„æ‰‹æœºæˆ–è€…<code class="highlighter-rouge">Generic iOS Device</code></p>

<p><img src="/img/20200506/4.webp" alt="é¡¹ç›®4" /></p>

<p>å¦‚å›¾æ“ä½œï¼Œç„¶åæŒ‰é”®<code class="highlighter-rouge">command+b</code>ç¼–è¯‘å³å¯</p>

<p>å¦‚æœä¹‹å‰çš„æ­¥éª¤åˆ é™¤äº†<code class="highlighter-rouge">compile-ffmpeg.sh</code>ä¸­<code class="highlighter-rouge">armv7</code>, è¿™é‡Œä¼šæŠ¥é”™, æˆ‘ä»¬ç›´æ¥æ³¨é‡Šæ‰å°±å¥½(å°ä¼™ä¼´ä»”ç»†çœ‹å•Š,ä¸‹é¢ä¸¤å¼ å›¾ä¸ä¸€æ ·çš„)</p>

<p><img src="/img/20200506/5.webp" alt="é¡¹ç›®5" />
<img src="/img/20200506/6.webp" alt="é¡¹ç›®6" /></p>

<blockquote>
  <p>å…·ä½“è·¯å¾„<br />
â€”-&gt; /Users/chasitu/Desktop/ijkplayer/ijkplayer-ios/ios/build/universal/include/libavutil/avconfig.h<br />
â€”â€“&gt; /Users/chasitu/Desktop/ijkplayer/ijkplayer-ios/ios/build/universal/include/libffmpeg/config.h</p>
</blockquote>

<blockquote>
  <p>å…·ä½“æ–‡ä»¶è·¯å¾„è¿™æ ·æŸ¥çœ‹<br />
<img src="/img/20200506/7.webp" alt="é¡¹ç›®7" /></p>
</blockquote>

<p>å¦‚å›¾æ“ä½œï¼Œç„¶å<code class="highlighter-rouge">command+b</code>ç¼–è¯‘å³å¯</p>

<p>3.åˆå¹¶<code class="highlighter-rouge">framework</code></p>

<p>å¦‚æœåªéœ€è¦çœŸæœºè¿è¡Œæˆ–è€…æ¨¡æ‹Ÿå™¨è¿è¡Œ, å¯ä»¥ä¸ç”¨åˆå¹¶, ç›´æ¥æ‰¾åˆ°å¯¹åº”çš„<code class="highlighter-rouge">framework</code>å¯¼å…¥é¡¹ç›®å³å¯; ä¸€èˆ¬æˆ‘ä»¬ä¸ºäº†æ–¹ä¾¿ä¼šåˆå¹¶ <code class="highlighter-rouge">framework</code>, è¿™æ ·å°±åŒæ—¶æ”¯æŒæ¨¡æ‹Ÿå™¨å’ŒçœŸæœºè¿è¡Œ.
å…ˆæ‰¾åˆ°ç”Ÿæˆ<code class="highlighter-rouge">framework</code>çš„ç›®å½•:</p>

<p><img src="/img/20200506/8.webp" alt="é¡¹ç›®8" />
<img src="/img/20200506/9.webp" alt="é¡¹ç›®9" /></p>

<p>å‡†å¤‡åˆå¹¶:
æ‰“å¼€ç»ˆç«¯, å…ˆ<code class="highlighter-rouge">cd</code>åˆ°<code class="highlighter-rouge">Products</code>ç›®å½•ä¸‹
ç„¶åæ‰§è¡Œ:<code class="highlighter-rouge">lipo -create</code>çœŸæœº<code class="highlighter-rouge">framework</code>è·¯å¾„ æ¨¡æ‹Ÿå™¨<code class="highlighter-rouge">framework</code>è·¯å¾„ -<code class="highlighter-rouge">output</code> åˆå¹¶çš„æ–‡ä»¶è·¯å¾„</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lipo -create Release-iphoneos/IJKMediaFramework.framework/IJKMediaFramework Release-iphonesimulator/IJKMediaFramework.framework/IJKMediaFramework -output IJKMediaFramework
</code></pre></div></div>

<p>åˆå¹¶å®Œæˆ:
å¯ä»¥çœ‹åˆ°è¿™é‡Œç”Ÿæˆäº†ä¸€ä¸ªå¤§æ¦‚ä¸¤å€å¤§å°çš„æ–‡ä»¶, å°†ç”Ÿæˆçš„<code class="highlighter-rouge">IJKMediaFramework</code>æ–‡ä»¶æ›¿æ¢æ‰ çœŸæœº<code class="highlighter-rouge">framework</code>ä¸­çš„ <code class="highlighter-rouge">IJKMediaFramework</code>æ–‡ä»¶ï¼Œç„¶åè¿™ä¸ªæ›¿æ¢æ‰æ–‡ä»¶çš„ çœŸæœº<code class="highlighter-rouge">framework</code>å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„ é€šç”¨çš„<code class="highlighter-rouge">framework</code>äº†ã€‚</p>

<p><img src="/img/20200506/10.webp" alt="é¡¹ç›®10" />
<img src="/img/20200506/11.webp" alt="é¡¹ç›®11" /></p>

<h4 id="é›†æˆ-framework-åˆ°é¡¹ç›®ä¸­">é›†æˆ framework åˆ°é¡¹ç›®ä¸­</h4>

<blockquote>
  <p>å¯¼å…¥ framework<br />
ç›´æ¥å°† IJKMediaFramework.framework æ‹–å…¥åˆ°å·¥ç¨‹ä¸­å³å¯
æ³¨æ„è®°å¾—å‹¾é€‰ Copy items if needed å’Œ å¯¹åº”çš„ target</p>
</blockquote>

<blockquote>
  <p>æ·»åŠ ä¸‹åˆ—ä¾èµ–åˆ°å·¥ç¨‹</p>
  <ol>
    <li>libc++.tbd ( ç¼–è¯‘å™¨é€‰ gcc çš„è¯·å¯¼å…¥libstdc++.tbd)<br />
libz.tbd<br />
libbz2.tbd<br />
AudioToolbox.framework<br />
UIKit.framework<br />
CoreGraphics.framework<br />
AVFoundation.framework<br />
CoreMedia.framework<br />
CoreVideo.framework<br />
MediaPlayer.framework<br />
MobileCoreServices.framework<br />
OpenGLES.framework<br />
QuartzCore.framework<br />
VideoToolbox.framework</li>
  </ol>
</blockquote>

<p><a href="https://www.jianshu.com/p/444194035787">è½¬è½½ç®€ä¹¦åœ°å€</a></p>
:ET